<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Examino</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:     #000000;
  --s1:     #0a0a0a;
  --s2:     #111111;
  --b1:     #1a1a1a;
  --b2:     #252525;
  --b3:     #333333;
  --y:      #ffe600;        /* HOT YELLOW — primary accent */
  --y2:     rgba(255,230,0,.07);
  --y3:     rgba(255,230,0,.15);
  --red:    #ff3333;
  --green:  #00e676;
  --blue:   #00b4ff;
  --orange: #ff7b00;
  --text:   #d0d0d0;
  --dim:    #555555;
  --head:   #ffffff;
  --r:      6px;
}
html{font-size:16px;scroll-behavior:smooth}
body{
  background:var(--bg);color:var(--text);
  font-family:'Space Grotesk',sans-serif;font-weight:400;
  min-height:100vh;overflow-x:hidden;
}

/* noise grain overlay */
body::after{
  content:'';position:fixed;inset:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events:none;z-index:0;opacity:.4;
}

.wrap{max-width:1140px;margin:0 auto;padding:0 28px;position:relative;z-index:1}

/* ─── HEADER ──────────────────────────────────────── */
header{
  border-bottom:1px solid var(--b1);position:sticky;top:0;z-index:200;
  background:rgba(0,0,0,.95);backdrop-filter:blur(20px);
}
.hdr{display:flex;align-items:center;justify-content:space-between;
     max-width:1140px;margin:0 auto;padding:0 28px;height:60px}
.logo{display:flex;align-items:center;gap:12px;text-decoration:none}
.logo-sym{
  font-family:'Space Mono',monospace;font-size:1.1rem;font-weight:700;
  color:var(--bg);background:var(--y);padding:4px 10px;border-radius:4px;
  letter-spacing:-.02em;
}
.logo-name{
  font-family:'Space Mono',monospace;font-size:.95rem;font-weight:700;
  color:var(--head);letter-spacing:.08em;text-transform:uppercase;
}
.logo-tag{
  font-size:.55rem;color:var(--dim);letter-spacing:.15em;border:1px solid var(--b2);
  border-radius:3px;padding:2px 6px;text-transform:uppercase;margin-left:2px;
}
nav{display:flex;gap:0}
.nb{
  background:transparent;border:none;color:var(--dim);
  padding:8px 18px;cursor:pointer;font-family:'Space Grotesk',sans-serif;
  font-size:.72rem;font-weight:600;letter-spacing:.08em;text-transform:uppercase;
  transition:color .15s;position:relative;
}
.nb::after{
  content:'';position:absolute;bottom:-1px;left:0;right:0;height:2px;
  background:var(--y);transform:scaleX(0);transition:transform .2s;
}
.nb:hover{color:var(--text)}
.nb.active{color:var(--y)}
.nb.active::after{transform:scaleX(1)}

/* ─── PAGES ────────────────────────────────────────── */
.page{display:none;padding:40px 0 100px;opacity:0}
.page.visible{display:block}

/* ─── HERO ─────────────────────────────────────────── */
.hero{
  padding:72px 0 56px;
  display:grid;grid-template-columns:1fr 380px;gap:56px;align-items:center;
}
.hero-eyebrow{
  display:inline-flex;align-items:center;gap:8px;margin-bottom:24px;
  font-family:'Space Mono',monospace;font-size:.6rem;letter-spacing:.2em;
  text-transform:uppercase;color:var(--y);
}
.dot{width:6px;height:6px;background:var(--y);border-radius:50%;animation:pulse 1.5s ease infinite}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(.8)}}
.hero-h1{
  font-size:clamp(2.6rem,5.5vw,4.2rem);font-weight:700;color:var(--head);
  line-height:1.0;letter-spacing:-.03em;margin-bottom:20px;
}
.hero-h1 em{color:var(--y);font-style:normal;position:relative;display:inline-block}
.hero-h1 em::after{
  content:'';position:absolute;bottom:-4px;left:0;right:0;height:3px;
  background:var(--y);border-radius:2px;
}
.hero-sub{color:var(--dim);font-size:.9rem;line-height:1.8;margin-bottom:36px;max-width:420px}
.hero-cta{display:flex;gap:12px}
.btn{
  padding:11px 24px;border-radius:var(--r);font-family:'Space Grotesk',sans-serif;
  font-size:.72rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;
  cursor:pointer;transition:all .18s;border:1px solid;
}
.btn-y{background:var(--y);border-color:var(--y);color:#000}
.btn-y:hover{background:transparent;color:var(--y)}
.btn-out{background:transparent;border-color:var(--b3);color:var(--dim)}
.btn-out:hover{border-color:var(--y);color:var(--y)}

/* hero stats panel */
.hero-panel{
  background:var(--s1);border:1px solid var(--b1);border-radius:12px;
  overflow:hidden;
}
.panel-hdr{
  background:var(--y);padding:12px 20px;
  font-family:'Space Mono',monospace;font-size:.65rem;font-weight:700;
  letter-spacing:.1em;color:#000;text-transform:uppercase;
}
.panel-body{padding:0}
.panel-row{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 20px;border-bottom:1px solid var(--b1);
}
.panel-row:last-child{border-bottom:none}
.panel-lbl{font-size:.7rem;color:var(--dim);letter-spacing:.06em}
.panel-val{font-family:'Space Mono',monospace;font-size:1.1rem;font-weight:700;color:var(--head)}
.panel-val.y{color:var(--y)}

/* subject grid */
.section{margin-bottom:56px}
.sec-row{display:flex;align-items:baseline;justify-content:space-between;margin-bottom:20px}
.sec-title{
  font-family:'Space Mono',monospace;font-size:.65rem;font-weight:700;
  letter-spacing:.2em;text-transform:uppercase;color:var(--y);
}
.sec-meta{font-size:.65rem;color:var(--dim)}
.subj-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.subj-card{
  background:var(--s1);border:1px solid var(--b1);border-radius:8px;
  padding:20px;cursor:pointer;transition:all .2s;
  display:flex;flex-direction:column;gap:10px;opacity:0;
  position:relative;overflow:hidden;
}
.subj-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:var(--sc,var(--y));transform:scaleX(0);transition:transform .2s;
  transform-origin:left;
}
.subj-card:hover::before,.subj-card.sel::before{transform:scaleX(1)}
.subj-card:hover{border-color:var(--b3);background:var(--s2);transform:translateY(-2px)}
.subj-card.sel{border-color:var(--y);background:var(--y2)}
.subj-ico{
  width:34px;height:34px;border-radius:6px;background:var(--b1);
  display:flex;align-items:center;justify-content:center;color:var(--y);
}
.subj-ico svg{width:16px;height:16px}
.subj-name{font-size:.85rem;font-weight:700;color:var(--head)}
.subj-hint{font-size:.62rem;color:var(--dim)}

/* ─── QB BROWSER ───────────────────────────────────── */
.qb-layout{display:grid;grid-template-columns:240px 1fr;gap:16px;margin-top:8px}
.qb-sidebar{
  background:var(--s1);border:1px solid var(--b1);border-radius:8px;
  padding:16px;height:fit-content;position:sticky;top:74px;
}
.sidebar-title{
  font-family:'Space Mono',monospace;font-size:.58rem;font-weight:700;
  letter-spacing:.2em;text-transform:uppercase;color:var(--dim);margin-bottom:12px;
}
.qb-subj-btn{
  background:transparent;border:1px solid transparent;border-radius:5px;
  padding:8px 10px;text-align:left;cursor:pointer;width:100%;
  font-family:'Space Grotesk',sans-serif;font-size:.75rem;color:var(--dim);
  transition:all .15s;display:flex;align-items:center;gap:8px;
}
.qb-subj-btn:hover{color:var(--text);background:var(--s2)}
.qb-subj-btn.active{color:var(--y);background:var(--y2);border-color:rgba(255,230,0,.15)}
.qb-unit-list{margin-top:8px;padding-top:8px;border-top:1px solid var(--b1)}
.qb-unit-btn{
  background:transparent;border:1px solid transparent;border-radius:5px;
  padding:6px 10px 6px 26px;text-align:left;cursor:pointer;width:100%;
  font-family:'Space Grotesk',sans-serif;font-size:.7rem;color:var(--dim);transition:all .15s;
}
.qb-unit-btn:hover{color:var(--text)}
.qb-unit-btn.active{color:var(--y)}
.qb-main{min-width:0}
.qb-topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px}
.qb-title{font-size:1rem;font-weight:700;color:var(--head)}
.chips{display:flex;gap:6px;flex-wrap:wrap}
.chip{
  background:var(--s2);border:1px solid var(--b2);color:var(--dim);
  padding:5px 13px;border-radius:99px;font-family:'Space Grotesk',sans-serif;
  font-size:.62rem;font-weight:600;letter-spacing:.06em;cursor:pointer;transition:all .15s;
}
.chip:hover{border-color:var(--b3);color:var(--text)}
.chip.active{border-color:var(--y);color:var(--y);background:var(--y2)}

/* ─── QUESTION CARD ─────────────────────────────────── */
.q-card{
  background:var(--s1);border:1px solid var(--b1);border-radius:8px;
  overflow:hidden;margin-bottom:10px;opacity:0;transition:border-color .2s;
}
.q-hdr{
  display:flex;align-items:center;gap:8px;flex-wrap:wrap;
  padding:10px 16px;background:var(--s2);border-bottom:1px solid var(--b1);
}
.qbadge{
  font-family:'Space Mono',monospace;font-size:.55rem;font-weight:700;
  letter-spacing:.06em;text-transform:uppercase;
  padding:3px 8px;border-radius:3px;border:1px solid;
}
.bm{color:var(--blue); border-color:var(--blue); background:rgba(0,180,255,.06)}
.bt{color:var(--orange);border-color:var(--orange);background:rgba(255,123,0,.06)}
.bf{color:#cc99ff;     border-color:#cc99ff;     background:rgba(204,153,255,.06)}
.bc{color:var(--y);    border-color:var(--y);    background:var(--y2)}
.q-topic{font-size:.6rem;color:var(--dim);margin-left:auto}
.q-subj{font-size:.6rem;color:var(--dim)}
.q-diff{font-family:'Space Mono',monospace;font-size:.58rem;font-weight:700;letter-spacing:.06em;padding:2px 8px;border-radius:3px;border:1px solid}
.de{color:var(--green);border-color:rgba(0,230,118,.25)}
.dm{color:var(--orange);border-color:rgba(255,123,0,.25)}
.dh{color:var(--red);  border-color:rgba(255,51,51,.25)}
.q-body{padding:18px 18px 0}
.q-text{font-size:.88rem;line-height:1.78;color:var(--text)}
.q-text pre{
  background:#050505;border:1px solid var(--b2);border-radius:5px;
  padding:12px 16px;margin:12px 0;font-family:'Space Mono',monospace;
  font-size:.75rem;color:var(--y);line-height:1.6;overflow-x:auto;
}
.q-text code{
  font-family:'Space Mono',monospace;font-size:.8rem;
  background:var(--s2);border:1px solid var(--b1);border-radius:3px;
  padding:1px 5px;color:var(--y);
}
.opts{display:flex;flex-direction:column;gap:6px;margin-top:14px}
.opt{
  background:var(--s2);border:1px solid var(--b2);border-radius:6px;
  padding:10px 14px;cursor:pointer;font-size:.83rem;
  transition:border-color .15s,background .15s;
  display:flex;align-items:flex-start;gap:10px;
}
.opt:hover{border-color:var(--b3);background:var(--b1)}
.opt.sel  {border-color:var(--y);   background:var(--y2);   color:var(--y)}
.opt.ok   {border-color:var(--green);background:rgba(0,230,118,.06);color:var(--green);cursor:default}
.opt.bad  {border-color:var(--red);  background:rgba(255,51,51,.06); color:var(--red);  cursor:default}
.opt-lbl{
  min-width:22px;height:22px;border-radius:3px;background:var(--b2);
  font-family:'Space Mono',monospace;font-size:.58rem;font-weight:700;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;color:var(--dim);
}
.q-foot{padding:12px 18px 18px}
.btn-sub{
  background:transparent;border:1px solid var(--b3);color:var(--dim);
  padding:7px 18px;border-radius:99px;font-family:'Space Grotesk',sans-serif;
  font-size:.67rem;font-weight:600;letter-spacing:.08em;cursor:pointer;
  transition:all .18s;text-transform:uppercase;
}
.btn-sub:hover{border-color:var(--y);color:var(--y);background:var(--y2)}
.btn-sub:disabled{opacity:.3;cursor:default}
.feedback{
  margin-top:10px;padding:10px 14px;border-radius:6px;
  font-size:.78rem;display:none;line-height:1.65;
}
.feedback.ok {background:rgba(0,230,118,.05); border:1px solid rgba(0,230,118,.2); color:var(--green)}
.feedback.bad{background:rgba(255,51,51,.05);  border:1px solid rgba(255,51,51,.2);  color:var(--red)}
.feedback.show{display:block}

/* ─── PRACTICE ──────────────────────────────────────── */
.practice-setup{max-width:580px;margin:0 auto;padding-top:16px}
.ps-card{
  background:var(--s1);border:1px solid var(--b1);border-radius:8px;
  padding:28px;margin-bottom:12px;
}
.ps-title{
  font-size:.85rem;font-weight:700;color:var(--head);margin-bottom:18px;
  display:flex;align-items:center;gap:10px;
}
.num{
  width:24px;height:24px;background:var(--y);border-radius:4px;
  font-family:'Space Mono',monospace;font-size:.65rem;font-weight:700;color:#000;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
}
.subject-selector{display:grid;grid-template-columns:repeat(3,1fr);gap:7px;margin-bottom:6px}
.ss-btn{
  background:var(--s2);border:1px solid var(--b1);border-radius:6px;
  padding:10px 6px;text-align:center;cursor:pointer;
  font-family:'Space Grotesk',sans-serif;font-size:.68rem;font-weight:600;
  color:var(--dim);transition:all .15s;
}
.ss-btn:hover{border-color:var(--b3);color:var(--text)}
.ss-btn.sel{border-color:var(--y);color:var(--y);background:var(--y2)}
.diff-row,.qty-row{display:flex;gap:7px}
.diff-btn,.qty-btn{
  flex:1;background:var(--s2);border:1px solid var(--b1);border-radius:6px;
  padding:10px;text-align:center;cursor:pointer;
  font-family:'Space Grotesk',sans-serif;font-size:.68rem;font-weight:600;
  color:var(--dim);transition:all .15s;text-transform:uppercase;letter-spacing:.06em;
}
.diff-btn.sel.easy  {border-color:var(--green);color:var(--green);background:rgba(0,230,118,.05)}
.diff-btn.sel.medium{border-color:var(--orange);color:var(--orange);background:rgba(255,123,0,.05)}
.diff-btn.sel.hard  {border-color:var(--red);   color:var(--red);   background:rgba(255,51,51,.05)}
.diff-btn.sel       {border-color:var(--y);color:var(--y);background:var(--y2)}
.qty-btn.sel{border-color:var(--y);color:var(--y);background:var(--y2)}
.start-btn{
  width:100%;padding:14px;border-radius:6px;
  background:var(--y);border:1px solid var(--y);color:#000;
  font-family:'Space Grotesk',sans-serif;font-size:.8rem;font-weight:700;
  letter-spacing:.12em;text-transform:uppercase;cursor:pointer;transition:all .18s;margin-top:4px;
}
.start-btn:hover{background:transparent;color:var(--y)}
.start-btn:disabled{opacity:.35;cursor:default;background:var(--b2);color:var(--dim);border-color:var(--b2)}

.practice-session{display:none}
.ps-progress{
  display:flex;align-items:center;gap:14px;
  background:var(--s1);border:1px solid var(--b1);border-radius:8px;
  padding:12px 18px;margin-bottom:16px;
}
.ps-prog-bar{flex:1;height:3px;background:var(--b1);border-radius:2px;overflow:hidden}
.ps-prog-fill{height:100%;background:var(--y);border-radius:2px;transition:width .4s ease}
.ps-prog-txt{font-family:'Space Mono',monospace;font-size:.62rem;color:var(--dim);white-space:nowrap}
.ps-score{font-family:'Space Mono',monospace;font-size:.62rem;color:var(--y);white-space:nowrap}
.ps-nav{display:flex;gap:10px;margin-top:14px;justify-content:flex-end}

.practice-results{max-width:540px;margin:0 auto;text-align:center;display:none}
.result-score{
  font-family:'Space Mono',monospace;font-size:5.5rem;font-weight:700;
  color:var(--y);line-height:1;margin-bottom:6px;
}
.result-label{font-family:'Space Mono',monospace;font-size:.65rem;letter-spacing:.25em;text-transform:uppercase;color:var(--dim);margin-bottom:32px}
.result-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:28px}
.rg-item{background:var(--s1);border:1px solid var(--b1);border-radius:8px;padding:18px}
.rg-n{font-family:'Space Mono',monospace;font-size:2rem;font-weight:700;color:var(--head);line-height:1;margin-bottom:4px}
.rg-l{font-size:.6rem;letter-spacing:.12em;text-transform:uppercase;color:var(--dim)}

/* ─── UPLOAD SECTION ───────────────────────────────── */
.upload-card{
  background:var(--s1);border:1px solid var(--b1);border-radius:8px;
  padding:28px;margin-bottom:24px;
}
.upload-title{
  font-size:.85rem;font-weight:700;color:var(--head);
  display:flex;align-items:center;gap:10px;margin-bottom:6px;
}
.upload-sub{font-size:.75rem;color:var(--dim);margin-bottom:24px;line-height:1.6}

.drop-zone{
  border:2px dashed var(--b3);border-radius:8px;padding:40px 20px;text-align:center;
  cursor:pointer;transition:all .2s;background:var(--s2);position:relative;
}
.drop-zone:hover,.drop-zone.drag-over{border-color:var(--y);background:var(--y2)}
.drop-zone input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.drop-icon{
  width:48px;height:48px;border-radius:50%;background:var(--b1);border:1px solid var(--b2);
  display:flex;align-items:center;justify-content:center;margin:0 auto 14px;
}
.drop-icon svg{width:22px;height:22px;color:var(--y)}
.drop-title{font-size:.9rem;font-weight:700;color:var(--head);margin-bottom:6px}
.drop-hint{font-size:.72rem;color:var(--dim)}
.drop-hint span{color:var(--y)}

.upload-fields{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:18px}
.field-wrap{display:flex;flex-direction:column;gap:5px}
.field-lbl{font-size:.65rem;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:var(--dim)}
.field-inp{
  background:var(--s2);border:1px solid var(--b2);border-radius:5px;
  padding:8px 12px;font-family:'Space Grotesk',sans-serif;font-size:.8rem;color:var(--head);
  transition:border-color .15s;
}
.field-inp:focus{outline:none;border-color:var(--y)}
.field-inp::placeholder{color:var(--dim)}

.qty-field{
  display:flex;align-items:center;gap:10px;margin-top:10px;
}
.qty-field .field-lbl{white-space:nowrap}
.qty-slider{
  flex:1;-webkit-appearance:none;height:3px;background:var(--b2);border-radius:2px;cursor:pointer;
}
.qty-slider::-webkit-slider-thumb{
  -webkit-appearance:none;width:16px;height:16px;border-radius:50%;
  background:var(--y);cursor:pointer;
}
.qty-val{
  font-family:'Space Mono',monospace;font-size:.8rem;font-weight:700;
  color:var(--y);min-width:20px;text-align:center;
}

.upload-btn{
  width:100%;padding:13px;border-radius:6px;margin-top:16px;
  background:var(--y);border:1px solid var(--y);color:#000;
  font-family:'Space Grotesk',sans-serif;font-size:.75rem;font-weight:700;
  letter-spacing:.1em;text-transform:uppercase;cursor:pointer;transition:all .18s;
}
.upload-btn:hover{background:transparent;color:var(--y)}
.upload-btn:disabled{opacity:.35;cursor:default;background:var(--b2);color:var(--dim);border-color:var(--b2)}

.upload-result{
  margin-top:16px;padding:16px;border-radius:6px;display:none;
}
.upload-result.ok {background:rgba(0,230,118,.05);border:1px solid rgba(0,230,118,.2)}
.upload-result.err{background:rgba(255,51,51,.05); border:1px solid rgba(255,51,51,.2)}
.upload-result.show{display:block}
.ur-title{font-size:.8rem;font-weight:700;margin-bottom:8px}
.ur-title.ok {color:var(--green)}
.ur-title.err{color:var(--red)}
.ur-row{display:flex;justify-content:space-between;font-size:.75rem;padding:4px 0;border-bottom:1px solid var(--b1);color:var(--text)}
.ur-row:last-child{border-bottom:none}
.ur-row span{color:var(--y);font-family:'Space Mono',monospace;font-weight:700}
.ur-msg{font-size:.75rem;color:var(--dim);margin-top:8px}

/* ─── STATS ─────────────────────────────────────────── */
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:28px}
.stat-tile{
  background:var(--s1);border:1px solid var(--b1);border-radius:8px;
  padding:20px;position:relative;overflow:hidden;
}
.stat-tile::after{
  content:'';position:absolute;top:-16px;right:-16px;
  width:64px;height:64px;border-radius:50%;
  background:radial-gradient(circle,var(--gw) 0%,transparent 70%);
  opacity:.5;pointer-events:none;
}
.tg{--gw:rgba(255,230,0,.6)}.ta{--gw:rgba(255,123,0,.6)}.tb{--gw:rgba(0,180,255,.6)}
.st-n{font-family:'Space Mono',monospace;font-size:2.6rem;font-weight:700;color:var(--head);line-height:1;margin-bottom:4px;letter-spacing:-.02em}
.st-l{font-size:.6rem;letter-spacing:.15em;text-transform:uppercase;color:var(--dim)}
.sp-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:24px}
.sp-card{background:var(--s1);border:1px solid var(--b1);border-radius:8px;padding:18px;opacity:0}
.sp-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.sp-name{font-size:.82rem;font-weight:700;color:var(--head);display:flex;align-items:center;gap:8px}
.sp-acc{font-family:'Space Mono',monospace;font-size:.68rem;font-weight:700;padding:3px 8px;border-radius:3px;border:1px solid}
.ring{position:relative;width:48px;height:48px;flex-shrink:0}
.ring svg{width:48px;height:48px;transform:rotate(-90deg)}
.ring-bg{fill:none;stroke:var(--b1);stroke-width:4}
.ring-fill{fill:none;stroke-width:4;stroke-linecap:round}
.ring-val{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:'Space Mono',monospace;font-size:.55rem;font-weight:700;color:var(--head)}
.ring-wrap{display:flex;align-items:center;gap:12px}
.ri-n{font-size:.8rem;color:var(--text);margin-bottom:2px}
.ri-m{font-size:.62rem;color:var(--dim)}
.topic-card{background:var(--s1);border:1px solid var(--b1);border-radius:8px;padding:20px}
.ttable{width:100%;border-collapse:collapse}
.ttable th{
  font-family:'Space Mono',monospace;font-size:.55rem;font-weight:700;
  letter-spacing:.12em;text-transform:uppercase;color:var(--dim);
  padding:8px 12px;border-bottom:1px solid var(--b1);text-align:left;
}
.ttable td{padding:9px 12px;border-bottom:1px solid var(--b1);font-size:.8rem;vertical-align:middle}
.ttable tr:last-child td{border-bottom:none}
.ttable tr:hover td{background:rgba(255,255,255,.01)}
.pbar{background:var(--b1);border-radius:2px;height:3px;overflow:hidden;width:80px}
.pbar-f{height:100%;border-radius:2px}

/* ─── MISC ──────────────────────────────────────────── */
#toast{
  position:fixed;bottom:24px;right:24px;
  background:var(--s1);border:1px solid var(--b2);color:var(--text);
  padding:10px 16px;border-radius:6px;font-family:'Space Grotesk',sans-serif;
  font-size:.7rem;font-weight:600;letter-spacing:.04em;
  z-index:999;pointer-events:none;opacity:0;transform:translateY(10px);
  transition:opacity .2s,transform .2s;max-width:280px;
}
#toast.show{opacity:1;transform:translateY(0)}
#toast.ok {border-color:rgba(0,230,118,.4);color:var(--green)}
#toast.err{border-color:rgba(255,51,51,.4);color:var(--red)}
.spin{display:inline-block;width:12px;height:12px;border:2px solid var(--b3);border-top-color:var(--y);border-radius:50%;animation:sp .6s linear infinite;vertical-align:middle}
@keyframes sp{to{transform:rotate(360deg)}}
.empty{text-align:center;padding:56px 20px;color:var(--dim);font-size:.82rem}
.empty h3{font-size:1.1rem;font-weight:700;color:var(--text);margin-bottom:8px}
.empty code{color:var(--y);font-family:'Space Mono',monospace}

@media(max-width:760px){
  .hero{grid-template-columns:1fr;padding:48px 0 36px}
  .hero-panel{display:none}
  .subj-grid{grid-template-columns:repeat(2,1fr)}
  .qb-layout{grid-template-columns:1fr}
  .qb-sidebar{position:static}
  .stats-grid,.sp-grid,.upload-fields{grid-template-columns:1fr}
  .subject-selector{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>

<!-- ═══ HEADER ═══ -->
<header>
  <div class="hdr">
    <div class="logo">
      <span class="logo-sym">EX</span>
      <span class="logo-name">Examino</span>
      <span class="logo-tag">PESU · SEM 1</span>
    </div>
    <nav>
      <button class="nb active" onclick="showPage('home')">Home</button>
      <button class="nb" onclick="showPage('qb')">Question Bank</button>
      <button class="nb" onclick="showPage('upload')">Upload PDF</button>
      <button class="nb" onclick="showPage('practice')">Practice</button>
      <button class="nb" onclick="showPage('stats')">Stats</button>
    </nav>
  </div>
</header>

<div id="toast"></div>

<!-- ═══════════ HOME ═══════════ -->
<div id="page-home" class="page visible">
<div class="wrap">
  <div class="hero">
    <div class="hero-left">
      <div class="hero-eyebrow"><span class="dot"></span>Adaptive · Official PESU QB</div>
      <h1 class="hero-h1">Master your<br><em>sem exams.</em></h1>
      <p class="hero-sub">Practice from official PESU Question Banks. Upload your own PDFs and auto-generate MCQs. Track your accuracy topic by topic.</p>
      <div class="hero-cta">
        <button class="btn btn-y" onclick="showPage('practice')">Start Practice</button>
        <button class="btn btn-out" onclick="showPage('upload')">Upload PDF →</button>
      </div>
    </div>
    <div class="hero-panel">
      <div class="panel-hdr">// live stats</div>
      <div class="panel-body">
        <div class="panel-row"><span class="panel-lbl">Questions</span><span class="panel-val y" id="h-qs">—</span></div>
        <div class="panel-row"><span class="panel-lbl">Attempts</span><span class="panel-val" id="h-att">—</span></div>
        <div class="panel-row"><span class="panel-lbl">Accuracy</span><span class="panel-val" id="h-acc">—</span></div>
        <div class="panel-row"><span class="panel-lbl">Subjects</span><span class="panel-val" id="h-sub">—</span></div>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="sec-row">
      <span class="sec-title">// Subjects</span>
      <span class="sec-meta" id="home-sub-meta"></span>
    </div>
    <div class="subj-grid" id="home-subj-grid"></div>
  </div>
</div>
</div>

<!-- ═══════════ QB ═══════════ -->
<div id="page-qb" class="page">
<div class="wrap">
  <div class="sec-row" style="margin-top:4px;margin-bottom:18px">
    <span class="sec-title">// Question Bank</span>
    <div class="chips" id="qb-diff-chips">
      <span class="chip active" onclick="setQBDiff(this,'all')">All</span>
      <span class="chip" onclick="setQBDiff(this,'easy')">Easy</span>
      <span class="chip" onclick="setQBDiff(this,'medium')">Medium</span>
      <span class="chip" onclick="setQBDiff(this,'hard')">Hard</span>
    </div>
  </div>
  <div class="qb-layout">
    <div class="qb-sidebar">
      <div class="sidebar-title">Subjects & Units</div>
      <div id="qb-subj-list"></div>
    </div>
    <div class="qb-main">
      <div class="qb-topbar">
        <span class="qb-title" id="qb-main-title">Select a subject</span>
        <span class="sec-meta" id="qb-count"></span>
      </div>
      <div id="qb-q-list">
        <div class="empty"><h3>Select a subject</h3><p>Use the sidebar to browse by subject and unit.</p></div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- ═══════════ UPLOAD PDF ═══════════ -->
<div id="page-upload" class="page">
<div class="wrap" style="max-width:700px">

  <div class="sec-row" style="margin-top:4px;margin-bottom:24px">
    <span class="sec-title">// Upload Study Material</span>
  </div>

  <div class="upload-card">
    <div class="upload-title">
      <span class="num">↑</span>
      Auto-Generate MCQs from PDF
    </div>
    <p class="upload-sub">
      Upload any PDF — lecture notes, textbook chapters, or past papers.
      Examino will extract the text, split it into sections, and generate
      structured MCQs automatically. No API key needed for basic mode.
    </p>

    <div class="drop-zone" id="drop-zone" onclick="document.getElementById('pdf-input').click()">
      <input type="file" id="pdf-input" accept=".pdf" onchange="handleFileSelect(this)"/>
      <div class="drop-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round">
          <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
          <polyline points="14,2 14,8 20,8"/>
          <line x1="12" y1="18" x2="12" y2="12"/>
          <polyline points="9,15 12,12 15,15"/>
        </svg>
      </div>
      <div class="drop-title" id="drop-title">Drop PDF here or click to browse</div>
      <div class="drop-hint">Only <span>.pdf</span> files · Max 20MB</div>
    </div>

    <div class="upload-fields">
      <div class="field-wrap">
        <label class="field-lbl">Subject (optional)</label>
        <input class="field-inp" id="up-subject" placeholder="e.g. EEE, Chemistry" />
      </div>
      <div class="field-wrap">
        <label class="field-lbl">Unit (optional)</label>
        <input class="field-inp" id="up-unit" placeholder="e.g. Unit 1" />
      </div>
      <div class="field-wrap" style="grid-column:1/-1">
        <label class="field-lbl">Topic Override (optional)</label>
        <input class="field-inp" id="up-topic" placeholder="Leave blank to auto-detect" />
      </div>
    </div>

    <div class="qty-field">
      <label class="field-lbl">Questions / section:</label>
      <input type="range" class="qty-slider" id="qps-slider" min="1" max="8" value="3"
             oninput="document.getElementById('qps-val').textContent=this.value"/>
      <span class="qty-val" id="qps-val">3</span>
    </div>

    <button class="upload-btn" id="upload-btn" onclick="uploadPDF()" disabled>
      Select a PDF first
    </button>

    <div class="upload-result" id="upload-result">
      <div class="ur-title" id="ur-title"></div>
      <div id="ur-rows"></div>
      <div class="ur-msg" id="ur-msg"></div>
    </div>
  </div>

  <!-- QB JSON live stats -->
  <div class="upload-card" id="qb-json-card">
    <div class="upload-title" style="justify-content:space-between">
      <span style="display:flex;align-items:center;gap:10px">
        <span class="num" style="background:var(--b1);color:var(--y);font-size:.7rem">QB</span>
        question_bank.json — Current State
      </span>
      <button class="btn btn-out" onclick="loadQBJsonStats()" style="padding:5px 12px;font-size:.6rem">↻</button>
    </div>
    <div id="qb-json-stats-wrap">
      <div style="text-align:center;padding:20px;color:var(--dim);font-size:.75rem">
        <span class="spin"></span> Loading…
      </div>
    </div>
  </div>

  <div class="upload-card">
    <div class="upload-title">
      <span class="num" style="background:var(--b2);color:var(--dim)">?</span>
      How it works
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:4px">
      <div style="background:var(--s2);border:1px solid var(--b1);border-radius:6px;padding:14px">
        <div style="color:var(--y);font-family:'Space Mono',monospace;font-size:.6rem;margin-bottom:8px">01 // EXTRACT</div>
        <div style="font-size:.75rem;color:var(--dim);line-height:1.6">PDF text is extracted using pdfplumber or PyPDF2, preserving structure.</div>
      </div>
      <div style="background:var(--s2);border:1px solid var(--b1);border-radius:6px;padding:14px">
        <div style="color:var(--y);font-family:'Space Mono',monospace;font-size:.6rem;margin-bottom:8px">02 // SPLIT</div>
        <div style="font-size:.75rem;color:var(--dim);line-height:1.6">Text is split into logical sections using heading detection and chunking.</div>
      </div>
      <div style="background:var(--s2);border:1px solid var(--b1);border-radius:6px;padding:14px">
        <div style="color:var(--y);font-family:'Space Mono',monospace;font-size:.6rem;margin-bottom:8px">03 // GENERATE</div>
        <div style="font-size:.75rem;color:var(--dim);line-height:1.6">MCQs are generated via Claude API (if key set) or smart heuristics.</div>
      </div>
      <div style="background:var(--s2);border:1px solid var(--b1);border-radius:6px;padding:14px">
        <div style="color:var(--y);font-family:'Space Mono',monospace;font-size:.6rem;margin-bottom:8px">04 // SAVE</div>
        <div style="font-size:.75rem;color:var(--dim);line-height:1.6">Questions are deduplicated by content hash and stored in the DB.</div>
      </div>
    </div>
  </div>

</div>
</div>

<!-- ═══════════ PRACTICE ═══════════ -->
<div id="page-practice" class="page">
<div class="wrap">

  <div id="practice-setup" class="practice-setup">
    <div class="ps-card">
      <div class="ps-title"><span class="num">1</span>Choose Subject</div>
      <div class="subject-selector" id="prac-subj-sel"></div>
    </div>
    <div class="ps-card">
      <div class="ps-title"><span class="num">2</span>Difficulty</div>
      <div class="diff-row">
        <div class="diff-btn easy sel" onclick="setPDiff(this,'easy')">Easy</div>
        <div class="diff-btn medium" onclick="setPDiff(this,'medium')">Medium</div>
        <div class="diff-btn hard" onclick="setPDiff(this,'hard')">Hard</div>
        <div class="diff-btn" onclick="setPDiff(this,'all')" style="flex:1.5">All</div>
      </div>
    </div>
    <div class="ps-card">
      <div class="ps-title"><span class="num">3</span>Number of Questions</div>
      <div class="qty-row">
        <div class="qty-btn sel" onclick="setPQty(this,5)">5</div>
        <div class="qty-btn" onclick="setPQty(this,10)">10</div>
        <div class="qty-btn" onclick="setPQty(this,15)">15</div>
        <div class="qty-btn" onclick="setPQty(this,20)">20</div>
      </div>
    </div>
    <button class="start-btn" id="start-btn" onclick="startPractice()">Start Session →</button>
  </div>

  <div id="practice-session" class="practice-session">
    <div class="ps-progress">
      <div class="ps-prog-bar"><div class="ps-prog-fill" id="ps-prog" style="width:0%"></div></div>
      <span class="ps-prog-txt" id="ps-prog-txt">0 / 0</span>
      <span class="ps-score" id="ps-score-live">0 correct</span>
    </div>
    <div id="ps-q-wrap"></div>
    <div class="ps-nav">
      <button class="btn btn-out" id="ps-next-btn" onclick="psNext()" style="display:none">Next →</button>
      <button class="btn btn-out" onclick="endPractice()">End Session</button>
    </div>
  </div>

  <div id="practice-results" class="practice-results">
    <div class="result-score" id="res-pct">0%</div>
    <div class="result-label">Session Complete</div>
    <div class="result-grid">
      <div class="rg-item"><div class="rg-n" id="res-correct">0</div><div class="rg-l">Correct</div></div>
      <div class="rg-item"><div class="rg-n" id="res-wrong">0</div><div class="rg-l">Wrong</div></div>
      <div class="rg-item"><div class="rg-n" id="res-total">0</div><div class="rg-l">Total</div></div>
    </div>
    <div style="display:flex;gap:12px;justify-content:center">
      <button class="btn btn-y" onclick="resetPractice()">Try Again</button>
      <button class="btn btn-out" onclick="showPage('stats')">View Stats</button>
    </div>
  </div>

</div>
</div>

<!-- ═══════════ STATS ═══════════ -->
<div id="page-stats" class="page">
<div class="wrap">
  <div class="sec-row" style="margin-top:4px;margin-bottom:20px">
    <span class="sec-title">// Performance Board</span>
    <button class="btn btn-out" onclick="loadStats()" style="padding:6px 14px;font-size:.62rem">↻ Refresh</button>
  </div>
  <div class="stats-grid">
    <div class="stat-tile tg"><div class="st-n" id="s-att">—</div><div class="st-l">Total Attempts</div></div>
    <div class="stat-tile ta"><div class="st-n" id="s-acc">—</div><div class="st-l">Overall Accuracy</div></div>
    <div class="stat-tile tb"><div class="st-n" id="s-top">—</div><div class="st-l">Topics Tracked</div></div>
  </div>
  <div class="sec-row" style="margin-bottom:14px"><span class="sec-title">// By Subject</span></div>
  <div class="sp-grid" id="sp-grid"></div>
  <div class="topic-card">
    <div class="sec-row" style="margin-bottom:14px"><span class="sec-title" style="font-size:.6rem">// Topic Breakdown</span></div>
    <div id="t-table-wrap">
      <div class="empty" style="padding:20px 0"><h3>No data yet</h3><p>Answer questions to see stats.</p></div>
    </div>
  </div>
</div>
</div>

<script>
// ═══════════════════════════════════════════════════════════
//  CONFIG
// ═══════════════════════════════════════════════════════════
const API = window.location.protocol === 'file:'
  ? 'http://localhost:8000'
  : window.location.origin;

const SUBJ_META = {
  Chemistry:{ col:'#00b4ff'  },
  EEE:      { col:'#ffe600'  },
  EPD:      { col:'#ff7b00'  },
  EVS:      { col:'#00e676'  },
  MES:      { col:'#cc99ff'  },
  Statics:  { col:'#ff3333'  },
};

const SUBJ_ICONS = {
  Chemistry:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><path d="M9 3h6M9 3v6l-5 9a2 2 0 001.7 3h12.6A2 2 0 0020 18l-5-9V3"/></svg>`,
  EEE:      `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>`,
  EPD:      `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>`,
  EVS:      `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><path d="M12 22V12M12 12C12 7 7 3 3 3c0 4 3 8 9 9M12 12c0-5 5-9 9-9-1 5-5 8-9 9"/></svg>`,
  MES:      `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><circle cx="12" cy="12" r="3"/><path d="M12 2v3M12 19v3M4.2 4.2l2.1 2.1M17.7 17.7l2.1 2.1M2 12h3M19 12h3"/></svg>`,
  Statics:  `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><path d="M3 21h18M12 3L3 21h18L12 3z"/></svg>`,
};
const FALLBACK_ICON = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M8 12h8M12 8v8"/></svg>`;

let answered={}, selected={};
let qbSubject='', qbUnit='', qbDiff='all', qbAllSubjects=[];
let pSubject='all', pDiff='easy', pQty=5;
let psQuestions=[], psCurrent=0, psCorrect=0, psAnswered={};
let selectedFile=null;

// ═══════════════════════════════════════════════════════════
//  UTILS
// ═══════════════════════════════════════════════════════════
function toast(msg,type='ok'){
  const t=document.getElementById('toast');
  t.textContent=msg;t.className=`show ${type}`;
  clearTimeout(t._t);t._t=setTimeout(()=>t.className='',3200);
}
function escH(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
function esc(s){return String(s||'').replace(/'/g,"\\'")}
function countUp(id,target){
  const el=document.getElementById(id);if(!el||!target)return;
  anime({targets:{v:0},v:target,duration:900,easing:'easeOutExpo',
    update(a){el.textContent=Math.round(a.animations[0].currentValue);}});
}

// ═══════════════════════════════════════════════════════════
//  NAVIGATION
// ═══════════════════════════════════════════════════════════
function showPage(name){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('visible'));
  document.querySelectorAll('.nb').forEach(b=>b.classList.remove('active'));
  const page=document.getElementById(`page-${name}`);
  page.classList.add('visible');
  const idx={home:0,qb:1,upload:2,practice:3,stats:4}[name]??0;
  document.querySelectorAll('.nb')[idx]?.classList.add('active');
  anime({targets:page,opacity:[0,1],translateY:[10,0],duration:300,easing:'easeOutCubic'});
  if(name==='home')     initHome();
  if(name==='qb')       initQB();
  if(name==='practice') initPractice();
  if(name==='upload')   loadQBJsonStats();
  if(name==='stats')    loadStats();
}

// ═══════════════════════════════════════════════════════════
//  HOME
// ═══════════════════════════════════════════════════════════
async function initHome(){
  anime({targets:'.hero-left',opacity:[0,1],translateY:[18,0],duration:500,easing:'easeOutExpo',delay:50});
  try{
    const [sRes,stRes]=await Promise.all([fetch(`${API}/subjects`),fetch(`${API}/stats`)]);
    const subjects=await sRes.json();
    const stats=await stRes.json();
    countUp('h-qs', stats.total_questions??0);
    countUp('h-att',stats.total_attempts??0);
    document.getElementById('h-acc').textContent=stats.total_attempts>0?`${stats.overall_accuracy}%`:'—';
    document.getElementById('h-sub').textContent=subjects.length;
    document.getElementById('home-sub-meta').textContent=`${stats.total_questions} questions loaded`;

    const grid=document.getElementById('home-subj-grid');
    grid.innerHTML=subjects.map(s=>{
      const m=SUBJ_META[s]||{col:'#ffe600'};
      const ico=SUBJ_ICONS[s]||FALLBACK_ICON;
      const bys=stats.by_subject?.[s];
      const hint=bys?`${bys.attempts} attempts · ${bys.accuracy}%`:'start practising';
      return `<div class="subj-card" style="--sc:${m.col}" onclick="goPractice('${s}')">
        <div class="subj-ico" style="color:${m.col};border-color:rgba(255,255,255,.06)">${ico}</div>
        <div class="subj-name">${s}</div>
        <div class="subj-hint">${hint}</div>
      </div>`;
    }).join('');
    anime({targets:'.subj-card',opacity:[0,1],translateY:[14,0],
      delay:anime.stagger(50,{start:120}),duration:340,easing:'easeOutCubic'});
  }catch(e){
    document.getElementById('home-subj-grid').innerHTML=
      `<div class="empty" style="grid-column:1/-1"><h3>API Offline</h3>
       <p>Run <code>uvicorn main:app --reload</code> in the backend folder.</p></div>`;
  }
}
function goPractice(s){pSubject=s;showPage('practice');}

// ═══════════════════════════════════════════════════════════
//  QB BROWSER
// ═══════════════════════════════════════════════════════════
async function initQB(){
  if(qbAllSubjects.length) return;
  try{
    qbAllSubjects=await (await fetch(`${API}/subjects`)).json();
    buildQBSidebar();
  }catch(e){}
}

function buildQBSidebar(){
  const list=document.getElementById('qb-subj-list');
  list.innerHTML=qbAllSubjects.map(s=>{
    const m=SUBJ_META[s]||{col:'#ffe600'};
    const ico=SUBJ_ICONS[s]||FALLBACK_ICON;
    return `<button class="qb-subj-btn" onclick="selectQBSubject('${s}',this)">
      <span style="color:${m.col};width:14px;height:14px;flex-shrink:0">${ico}</span>${s}
    </button>`;
  }).join('');
}

async function selectQBSubject(subj,el){
  qbSubject=subj; qbUnit='';
  document.querySelectorAll('.qb-subj-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('qb-main-title').textContent=subj;
  try{
    const units=await (await fetch(`${API}/units?subject=${encodeURIComponent(subj)}`)).json();
    const existing=document.querySelector('.qb-unit-list');
    if(existing) existing.remove();
    if(units.length){
      const html=`<div class="qb-unit-list">
        <button class="qb-unit-btn active" onclick="selectQBUnit('',this)">All Units</button>
        ${units.map(u=>`<button class="qb-unit-btn" onclick="selectQBUnit('${esc(u)}',this)">${escH(u)}</button>`).join('')}
      </div>`;
      el.insertAdjacentHTML('afterend',html);
    }
  }catch(e){}
  loadQBQuestions();
}

function selectQBUnit(unit,el){
  qbUnit=unit;
  document.querySelectorAll('.qb-unit-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  loadQBQuestions();
}

function setQBDiff(el,diff){
  qbDiff=diff;
  document.querySelectorAll('#qb-diff-chips .chip').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  if(qbSubject) loadQBQuestions();
}

async function loadQBQuestions(){
  if(!qbSubject) return;
  const list=document.getElementById('qb-q-list');
  list.innerHTML=`<div style="text-align:center;padding:40px"><span class="spin"></span></div>`;
  let url=`${API}/questions?subject=${encodeURIComponent(qbSubject)}&limit=60`;
  if(qbUnit) url+=`&unit=${encodeURIComponent(qbUnit)}`;
  if(qbDiff!=='all') url+=`&difficulty=${qbDiff}`;
  try{
    const qs=await (await fetch(url)).json();
    document.getElementById('qb-count').textContent=`${qs.length} questions`;
    if(!qs.length){list.innerHTML=`<div class="empty"><h3>No questions</h3><p>Try different filters.</p></div>`;return;}
    answered={}; selected={};
    list.innerHTML=qs.map(q=>buildQCard(q)).join('');
    anime({targets:'#qb-q-list .q-card',opacity:[0,1],translateY:[10,0],
      delay:anime.stagger(25),duration:280,easing:'easeOutCubic'});
  }catch(e){
    list.innerHTML=`<div class="empty"><h3>Error</h3><p>${escH(e.message)}</p></div>`;
  }
}

// ═══════════════════════════════════════════════════════════
//  QUESTION CARD
// ═══════════════════════════════════════════════════════════
const TL={mcq:'MCQ',true_false:'T/F',fill_blank:'Fill',code:'Code',complexity:'Big-O'};
const KS=['A','B','C','D','E'];

function buildQCard(q, practiceMode=false){
  const txt=q.question_text
    .replace(/```([\s\S]*?)```/g,'<pre>$1</pre>')
    .replace(/`([^`]+)`/g,'<code>$1</code>');

  let inp='';
  if(q.options?.length){
    inp=`<div class="opts">${q.options.map((o,i)=>`
      <div class="opt" id="op-${q.question_id}-${i}"
           onclick="selOpt('${q.question_id}',${i},'${esc(o)}',${practiceMode})">
        <span class="opt-lbl">${KS[i]}</span>${escH(o)}
      </div>`).join('')}</div>`;
  }

  const bclass={mcq:'bm',true_false:'bt',fill_blank:'bf',code:'bc',complexity:'bc'}[q.question_type]||'bm';
  const dclass={easy:'de',medium:'dm',hard:'dh'}[q.difficulty_level]||'dm';

  return `<div class="q-card" id="qc-${q.question_id}">
    <div class="q-hdr">
      <span class="qbadge ${bclass}">${TL[q.question_type]||q.question_type}</span>
      <span class="q-topic">${escH(q.topic)}</span>
      <span class="q-subj">${escH(q.unit||'')}</span>
      <span class="q-diff ${dclass}">${q.difficulty_level}</span>
    </div>
    <div class="q-body"><div class="q-text">${txt}</div>${inp}</div>
    <div class="q-foot">
      <button class="btn-sub" id="btn-${q.question_id}"
              onclick="submitA('${q.question_id}','${q.question_type}',${practiceMode})">Submit</button>
      <div class="feedback" id="fb-${q.question_id}"></div>
    </div>
  </div>`;
}

function selOpt(qid,idx,val,practiceMode=false){
  if(answered[qid]) return;
  document.querySelectorAll(`[id^="op-${qid}-"]`).forEach(e=>e.classList.remove('sel'));
  const el=document.getElementById(`op-${qid}-${idx}`);
  el?.classList.add('sel'); selected[qid]=val;
  anime({targets:el,scale:[.97,1],duration:140,easing:'easeOutBack'});
}

async function submitA(qid,qtype,practiceMode=false){
  if(answered[qid]) return;
  const ans=selected[qid]||'';
  if(!ans){toast('Select an answer first','err');return;}

  const btn=document.getElementById(`btn-${qid}`);
  btn.disabled=true; btn.innerHTML='<span class="spin"></span>';

  try{
    const res=await fetch(`${API}/attempt`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({question_id:qid,user_answer:ans}),
    });
    if(!res.ok){const e=await res.json().catch(()=>({}));throw new Error(e.detail||`HTTP ${res.status}`);}
    const d=await res.json();
    answered[qid]=true; btn.style.display='none';

    document.querySelectorAll(`[id^="op-${qid}-"]`).forEach(el=>{
      const t=el.textContent.trim().replace(/^[A-E]\s*/,'');
      if(t===d.correct_answer.trim()||el.textContent.includes(d.correct_answer.trim()))
        el.classList.add('ok');
      else if(el.classList.contains('sel'))
        el.classList.add('bad');
      el.style.cursor='default';
    });

    const fb=document.getElementById(`fb-${qid}`);
    fb.className=`feedback show ${d.correct?'ok':'bad'}`;
    fb.innerHTML=`${d.correct?'✓ Correct':'✗ Wrong — correct: '+escH(d.correct_answer)}
      <span style="font-size:.58rem;display:block;margin-top:2px;opacity:.5">difficulty → ${d.new_difficulty}</span>`;
    anime({targets:fb,opacity:[0,1],translateY:[5,0],duration:220,easing:'easeOutCubic'});

    if(!d.correct){
      anime({targets:`#qc-${qid}`,translateX:[0,-5,5,-3,3,0],duration:340,easing:'easeInOutSine'});
      toast(`Answer: ${d.correct_answer}`,'err');
    } else {
      anime({targets:`#qc-${qid}`,borderColor:['#1a1a1a','#ffe600','#1a1a1a'],duration:500});
      toast('Correct!');
    }

    if(practiceMode){
      if(d.correct) psCorrect++;
      psAnswered[qid]=d.correct;
      document.getElementById('ps-score-live').textContent=`${psCorrect} correct`;
      document.getElementById('ps-next-btn').style.display='inline-flex';
    }
  }catch(e){
    btn.disabled=false;btn.textContent='Submit';
    toast(e.message||'Could not reach API','err');
  }
}

// ═══════════════════════════════════════════════════════════
//  PDF UPLOAD
// ═══════════════════════════════════════════════════════════
function handleFileSelect(input){
  const file=input.files[0];
  if(!file) return;
  selectedFile=file;
  document.getElementById('drop-title').textContent=`📄 ${file.name}`;
  const btn=document.getElementById('upload-btn');
  btn.disabled=false;btn.textContent='Generate Questions →';
}

// Drag and drop
const dz=document.getElementById('drop-zone');
dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('drag-over')});
dz.addEventListener('dragleave',()=>dz.classList.remove('drag-over'));
dz.addEventListener('drop',e=>{
  e.preventDefault();dz.classList.remove('drag-over');
  const f=e.dataTransfer.files[0];
  if(f&&f.name.endsWith('.pdf')){
    selectedFile=f;
    document.getElementById('drop-title').textContent=`📄 ${f.name}`;
    const btn=document.getElementById('upload-btn');
    btn.disabled=false;btn.textContent='Generate Questions →';
  } else {
    toast('Please drop a PDF file','err');
  }
});

async function uploadPDF(){
  if(!selectedFile){toast('Select a PDF first','err');return;}
  const btn=document.getElementById('upload-btn');
  btn.disabled=true;btn.innerHTML='<span class="spin"></span> Analysing PDF…';

  const fd=new FormData();
  fd.append('file',selectedFile);
  const subj=document.getElementById('up-subject').value.trim();
  const unit=document.getElementById('up-unit').value.trim();
  const topic=document.getElementById('up-topic').value.trim();
  const qps=document.getElementById('qps-slider').value;
  if(subj)  fd.append('subject',subj);
  if(unit)  fd.append('unit',unit);
  if(topic) fd.append('topic',topic);
  fd.append('questions_per_section',qps);

  const result=document.getElementById('upload-result');
  result.className='upload-result';
  result.style.display='none';

  try{
    const res=await fetch(`${API}/upload-material`,{method:'POST',body:fd});
    const data=await res.json();

    if(!res.ok) throw new Error(data.detail||`HTTP ${res.status}`);

    const urRows=[
      ['Subject detected',        data.subject],
      ['Unit',                    data.unit],
      ['Topic',                   data.topic],
      ['Sections processed',      data.sections_processed],
      ['Questions generated',     data.questions_generated],
      ['— DB: inserted',          data.db_inserted],
      ['— DB: dupes skipped',     data.db_skipped_duplicates],
      ['— QB JSON: inserted',     data.qb_inserted],
      ['— QB JSON: dupes skipped',data.qb_skipped_duplicates],
      ['QB subject total',        data.qb_subject_total],
    ];
    document.getElementById('ur-title').className='ur-title ok';
    document.getElementById('ur-title').textContent='✓ Upload Successful';
    document.getElementById('ur-rows').innerHTML=urRows.map(([l,v])=>
      `<div class="ur-row">${l}<span>${v}</span></div>`).join('');
    document.getElementById('ur-msg').textContent=data.message;
    result.className='upload-result ok show';

    toast(`${data.qb_inserted} questions added to QB!`);
    qbAllSubjects=[];  // force QB sidebar refresh
    loadQBJsonStats();  // refresh QB JSON stats panel

  }catch(e){
    document.getElementById('ur-title').className='ur-title err';
    document.getElementById('ur-title').textContent='✗ Upload Failed';
    document.getElementById('ur-rows').innerHTML='';
    document.getElementById('ur-msg').textContent=e.message||'Unknown error';
    result.className='upload-result err show';
    toast(e.message||'Upload failed','err');
  }finally{
    btn.disabled=false;btn.textContent='Generate Questions →';
  }
}

// ═══════════════════════════════════════════════════════════
//  PRACTICE MODE
// ═══════════════════════════════════════════════════════════
async function initPractice(){
  try{
    const subjects=await (await fetch(`${API}/subjects`)).json();
    const sel=document.getElementById('prac-subj-sel');
    sel.innerHTML=`<div class="ss-btn${pSubject==='all'?' sel':''}" onclick="setPSubj(this,'all')">All</div>`
      +subjects.map(s=>`<div class="ss-btn${pSubject===s?' sel':''}" onclick="setPSubj(this,'${s}')">${s}</div>`).join('');
  }catch(e){}
}

function setPSubj(el,s){
  pSubject=s;
  document.querySelectorAll('#prac-subj-sel .ss-btn').forEach(b=>b.classList.remove('sel'));
  el.classList.add('sel');
  anime({targets:el,scale:[.94,1],duration:160,easing:'easeOutBack'});
}
function setPDiff(el,d){
  pDiff=d;
  document.querySelectorAll('.diff-btn').forEach(b=>b.classList.remove('sel'));
  el.classList.add('sel');
}
function setPQty(el,n){
  pQty=n;
  document.querySelectorAll('.qty-btn').forEach(b=>b.classList.remove('sel'));
  el.classList.add('sel');
}

async function startPractice(){
  const btn=document.getElementById('start-btn');
  btn.disabled=true;btn.textContent='Loading…';
  let url=`${API}/questions?limit=${pQty}`;
  if(pSubject!=='all') url+=`&subject=${encodeURIComponent(pSubject)}`;
  if(pDiff!=='all') url+=`&difficulty=${pDiff}`;
  try{
    const qs=await (await fetch(url)).json();
    if(!qs.length){toast('No questions for these filters','err');btn.disabled=false;btn.textContent='Start Session →';return;}
    psQuestions=qs.sort(()=>Math.random()-.5).slice(0,pQty);
    psCurrent=0;psCorrect=0;psAnswered={};answered={};selected={};
    document.getElementById('practice-setup').style.display='none';
    document.getElementById('practice-results').style.display='none';
    const sess=document.getElementById('practice-session');
    sess.style.display='block';
    anime({targets:sess,opacity:[0,1],translateY:[12,0],duration:300,easing:'easeOutCubic'});
    renderPsQuestion();
  }catch(e){toast(e.message||'API error','err');}
  finally{btn.disabled=false;btn.textContent='Start Session →';}
}

function renderPsQuestion(){
  if(psCurrent>=psQuestions.length){endPractice();return;}
  const q=psQuestions[psCurrent];
  const wrap=document.getElementById('ps-q-wrap');
  wrap.innerHTML=buildQCard(q,true);
  anime({targets:'#ps-q-wrap .q-card',opacity:[0,1],translateY:[14,0],duration:280,easing:'easeOutCubic'});
  document.getElementById('ps-next-btn').style.display='none';
  const pct=Math.round((psCurrent/psQuestions.length)*100);
  document.getElementById('ps-prog').style.width=`${pct}%`;
  document.getElementById('ps-prog-txt').textContent=`${psCurrent+1} / ${psQuestions.length}`;
  document.getElementById('ps-score-live').textContent=`${psCorrect} correct`;
  delete answered[q.question_id]; delete selected[q.question_id];
}

function psNext(){psCurrent++;renderPsQuestion();}

function endPractice(){
  document.getElementById('practice-session').style.display='none';
  const total=Object.keys(psAnswered).length||psCurrent;
  const wrong=total-psCorrect;
  const pct=total>0?Math.round((psCorrect/total)*100):0;
  document.getElementById('res-pct').textContent=`${pct}%`;
  document.getElementById('res-correct').textContent=psCorrect;
  document.getElementById('res-wrong').textContent=wrong;
  document.getElementById('res-total').textContent=total;
  const res=document.getElementById('practice-results');
  res.style.display='block';
  anime({targets:res,opacity:[0,1],translateY:[18,0],duration:380,easing:'easeOutExpo'});
  anime({targets:'#res-pct',scale:[.8,1],duration:480,easing:'easeOutElastic(1,.65)'});
}

function resetPractice(){
  document.getElementById('practice-results').style.display='none';
  document.getElementById('practice-session').style.display='none';
  document.getElementById('practice-setup').style.display='block';
  psQuestions=[];psCurrent=0;psCorrect=0;psAnswered={};
  anime({targets:'#practice-setup',opacity:[0,1],translateY:[8,0],duration:260,easing:'easeOutCubic'});
}

// ═══════════════════════════════════════════════════════════
//  STATS
// ═══════════════════════════════════════════════════════════
async function loadStats(){
  try{
    const res=await fetch(`${API}/stats`);
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const data=await res.json();

    document.getElementById('s-att').textContent=data.total_attempts??0;
    document.getElementById('s-acc').textContent=data.total_attempts>0?`${data.overall_accuracy}%`:'—';
    document.getElementById('s-top').textContent=data.topics?.length??0;
    countUp('s-att',data.total_attempts??0);

    const grid=document.getElementById('sp-grid');
    const bySub=data.by_subject||{};
    const keys=Object.keys(bySub);

    if(!keys.length){
      grid.innerHTML=`<div class="empty" style="grid-column:1/-1"><h3>No data yet</h3><p>Answer questions to see subject performance.</p></div>`;
    } else {
      grid.innerHTML=keys.map(s=>{
        const d=bySub[s];
        const m=SUBJ_META[s]||{col:'#ffe600'};
        const pct=d.accuracy;
        const col=pct>=70?'var(--green)':pct>=40?'var(--orange)':'var(--red)';
        const r=18,circ=2*Math.PI*r;
        const ico=SUBJ_ICONS[s]||FALLBACK_ICON;
        return `<div class="sp-card">
          <div class="sp-hdr">
            <span class="sp-name">
              <span style="color:${m.col};width:14px;height:14px">${ico}</span>${s}
            </span>
            <span class="sp-acc" style="color:${col};border-color:${col}">${pct}%</span>
          </div>
          <div class="ring-wrap">
            <div class="ring">
              <svg viewBox="0 0 48 48">
                <circle class="ring-bg" cx="24" cy="24" r="${r}"/>
                <circle class="ring-fill" cx="24" cy="24" r="${r}"
                  stroke="${col}" stroke-dasharray="${circ}"
                  stroke-dashoffset="${circ}" data-target="${circ-(pct/100)*circ}"/>
              </svg>
              <div class="ring-val">${pct}%</div>
            </div>
            <div>
              <div class="ri-n">${d.attempts} attempts</div>
              <div class="ri-m">${d.correct} correct</div>
            </div>
          </div>
        </div>`;
      }).join('');

      anime({targets:'.sp-card',opacity:[0,1],translateY:[12,0],delay:anime.stagger(60),duration:320,easing:'easeOutCubic'});
      anime({
        targets:'.ring-fill',
        strokeDashoffset(el){return[parseFloat(el.getAttribute('stroke-dasharray')),parseFloat(el.getAttribute('data-target'))];},
        duration:800,delay:anime.stagger(70),easing:'easeOutCubic',
      });
    }

    const wrap=document.getElementById('t-table-wrap');
    if(!data.topics?.length){
      wrap.innerHTML=`<div class="empty" style="padding:20px 0"><h3>No topic data yet</h3></div>`;return;
    }
    wrap.innerHTML=`<table class="ttable">
      <thead><tr><th>Topic</th><th>Subject</th><th>Accuracy</th><th>Attempts</th><th>Difficulty</th></tr></thead>
      <tbody>${data.topics.map(t=>{
        const pct=t.accuracy;
        const fc=pct>=70?'var(--green)':pct>=40?'var(--orange)':'var(--red)';
        const dc={easy:'var(--green)',medium:'var(--orange)',hard:'var(--red)'}[t.difficulty]||'var(--dim)';
        return `<tr>
          <td>${escH(t.topic)}</td>
          <td style="font-size:.68rem;color:var(--dim)">${escH(t.subject)}</td>
          <td><div style="display:flex;align-items:center;gap:10px">
            <div class="pbar"><div class="pbar-f" style="width:${pct}%;background:${fc}"></div></div>
            <span style="font-family:'Space Mono',monospace;font-size:.68rem">${pct}%</span>
          </div></td>
          <td style="font-family:'Space Mono',monospace;font-size:.68rem">${t.attempts}</td>
          <td style="font-family:'Space Mono',monospace;font-size:.62rem;color:${dc}">${t.difficulty}</td>
        </tr>`;
      }).join('')}</tbody>
    </table>`;
    anime({targets:'.ttable tbody tr',opacity:[0,1],translateX:[-6,0],delay:anime.stagger(18),duration:220,easing:'easeOutCubic'});
  }catch(e){
    document.getElementById('sp-grid').innerHTML=
      `<div class="empty" style="grid-column:1/-1;color:var(--red)">API not reachable — start uvicorn first.</div>`;
  }
}

// ═══════════════════════════════════════════════════════════
//  QB JSON STATS (Upload page)
// ═══════════════════════════════════════════════════════════
async function loadQBJsonStats(){
  const wrap=document.getElementById('qb-json-stats-wrap');
  if(!wrap) return;
  wrap.innerHTML='<div style="text-align:center;padding:20px;color:var(--dim);font-size:.75rem"><span class="spin"></span> Loading…</div>';
  try{
    const res=await fetch(`${API}/qb-stats`);
    const data=await res.json();
    if(data.error){wrap.innerHTML=`<div style="color:var(--red);font-size:.75rem;padding:10px">${escH(data.error)}</div>`;return;}
    const subjs=data.subjects||{};
    const keys=Object.keys(subjs);
    if(!keys.length){
      wrap.innerHTML='<div style="color:var(--dim);font-size:.75rem;padding:10px">No questions in QB JSON yet.</div>';
      return;
    }
    const rows=keys.map(s=>{
      const m=SUBJ_META[s]||{col:'#ffe600'};
      return `<div style="display:flex;align-items:center;justify-content:space-between;padding:9px 0;border-bottom:1px solid var(--b1)">
        <span style="display:flex;align-items:center;gap:8px;font-size:.78rem;color:var(--text)">`+
        `<span style="width:8px;height:8px;border-radius:50%;background:${m.col};flex-shrink:0"></span>${escH(s)}</span>`+
        `<span style="font-family:'Space Mono',monospace;font-size:.78rem;color:var(--y)">${subjs[s]}</span>
      </div>`;
    }).join('');
    wrap.innerHTML=`
      <div style="padding:0 0 4px">${rows}</div>
      <div style="display:flex;justify-content:space-between;padding-top:10px;font-size:.7rem">
        <span style="color:var(--dim)">Total questions</span>
        <span style="font-family:'Space Mono',monospace;color:var(--head);font-weight:700">${data.total}</span>
      </div>
      <div style="font-size:.6rem;color:var(--dim);margin-top:6px;word-break:break-all">${escH(data.qb_path)}</div>`;
  }catch(e){
    wrap.innerHTML=`<div style="color:var(--red);font-size:.75rem;padding:10px">Could not reach API</div>`;
  }
}

// ═══════════════════════════════════════════════════════════
//  BOOT
// ═══════════════════════════════════════════════════════════
showPage('home');
</script>
</body>
</html>
</html>
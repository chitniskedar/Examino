<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Examino</title>
<link href="https://fonts.googleapis.com/css2?family=Quantico:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
<style>
/* ─── RESET & TOKENS ────────────────────────────────────────────────────── */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:    #07080a;
  --s1:    #0e1014;
  --s2:    #141720;
  --b1:    #1e2330;
  --b2:    #2d3448;
  --b3:    #3d4660;
  --g:     #c8ff00;        /* neon lime — primary accent   */
  --g2:    rgba(200,255,0,.08);
  --amber: #ffb300;
  --red:   #ff4757;
  --blue:  #4fc3f7;
  --purple:#b39ddb;
  --text:  #c8cfd8;
  --dim:   #4a5568;
  --head:  #f0f4ff;
  --r:     8px;
}
html{font-size:16px;scroll-behavior:smooth}
body{
  background:var(--bg);color:var(--text);
  font-family:'Quantico',sans-serif;font-weight:400;
  min-height:100vh;overflow-x:hidden;
}

/* scanline overlay */
body::before{
  content:'';position:fixed;inset:0;
  background:repeating-linear-gradient(
    0deg,transparent,transparent 2px,rgba(0,0,0,.04) 2px,rgba(0,0,0,.04) 4px
  );
  pointer-events:none;z-index:0;
}

.wrap{max-width:1100px;margin:0 auto;padding:0 28px;position:relative;z-index:1}

/* ─── HEADER ─────────────────────────────────────────────────────────────── */
header{
  border-bottom:1px solid var(--b1);position:sticky;top:0;z-index:200;
  background:rgba(7,8,10,.96);backdrop-filter:blur(24px);
}
.hdr{display:flex;align-items:center;justify-content:space-between;
     max-width:1100px;margin:0 auto;padding:14px 28px}
.logo{
  display:flex;align-items:center;gap:12px;
  font-size:1.35rem;font-weight:700;color:var(--head);letter-spacing:.05em;
}
.logo-mark{
  width:32px;height:32px;background:var(--g);border-radius:6px;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
}
.logo-mark svg{width:18px;height:18px;fill:var(--bg)}
.logo-sub{
  font-size:.6rem;color:var(--dim);letter-spacing:.15em;
  border:1px solid var(--b2);border-radius:4px;padding:2px 8px;margin-left:4px;
}
nav{display:flex;gap:2px}
.nb{
  background:transparent;border:none;color:var(--dim);
  padding:8px 16px;border-radius:var(--r);cursor:pointer;
  font-family:'Quantico',sans-serif;font-size:.75rem;font-weight:700;
  letter-spacing:.08em;text-transform:uppercase;transition:all .18s;
  position:relative;
}
.nb::after{
  content:'';position:absolute;bottom:4px;left:50%;transform:translateX(-50%);
  width:0;height:2px;background:var(--g);border-radius:2px;transition:width .2s;
}
.nb:hover{color:var(--text)}
.nb.active{color:var(--g)}
.nb.active::after{width:60%}

/* ─── PAGES ──────────────────────────────────────────────────────────────── */
.page{display:none;padding:40px 0 100px;opacity:0}
.page.visible{display:block}

/* ─── HERO ───────────────────────────────────────────────────────────────── */
.hero{
  padding:80px 0 56px;
  display:grid;grid-template-columns:1fr 1fr;gap:48px;align-items:center;
}
.hero-left{}
.hero-tag{
  display:inline-flex;align-items:center;gap:8px;
  font-size:.62rem;font-weight:700;letter-spacing:.2em;text-transform:uppercase;
  color:var(--g);border:1px solid rgba(200,255,0,.3);border-radius:4px;
  padding:4px 12px;margin-bottom:24px;
}
.hero-tag-dot{width:6px;height:6px;background:var(--g);border-radius:50%;animation:blink 1.4s ease-in-out infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
.hero-h1{
  font-size:clamp(2.4rem,5vw,3.8rem);font-weight:700;color:var(--head);
  line-height:1.05;letter-spacing:-.01em;margin-bottom:18px;
}
.hero-h1 .accent{color:var(--g);font-style:italic}
.hero-p{color:var(--dim);font-size:.9rem;line-height:1.8;margin-bottom:36px;max-width:400px}
.hero-cta{display:flex;gap:12px;flex-wrap:wrap}
.btn{
  padding:11px 24px;border-radius:var(--r);font-family:'Quantico',sans-serif;
  font-size:.75rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;
  cursor:pointer;transition:all .2s;border:1px solid;
}
.btn-primary{background:var(--g);border-color:var(--g);color:var(--bg)}
.btn-primary:hover{background:transparent;color:var(--g)}
.btn-ghost{background:transparent;border-color:var(--b2);color:var(--dim)}
.btn-ghost:hover{border-color:var(--g);color:var(--g)}

/* Hero stats */
.hero-right{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.h-stat{
  background:var(--s1);border:1px solid var(--b1);border-radius:12px;
  padding:20px;position:relative;overflow:hidden;
}
.h-stat::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,var(--glow,rgba(200,255,0,0)) 0%,transparent 60%);
  opacity:.4;pointer-events:none;
}
.hsg{--glow:rgba(200,255,0,.15)}.hsa{--glow:rgba(255,179,0,.15)}
.hsb{--glow:rgba(79,195,247,.15)}.hsp{--glow:rgba(179,157,219,.15)}
.h-stat-n{font-size:2.2rem;font-weight:700;color:var(--head);line-height:1;margin-bottom:4px}
.h-stat-l{font-size:.6rem;letter-spacing:.15em;text-transform:uppercase;color:var(--dim)}

/* ─── SUBJECT GRID ───────────────────────────────────────────────────────── */
.subj-section{margin-bottom:48px}
.sec-hdr{display:flex;align-items:baseline;justify-content:space-between;margin-bottom:20px}
.sec-title{font-size:1rem;font-weight:700;color:var(--head);letter-spacing:.08em;text-transform:uppercase}
.sec-meta{font-size:.65rem;color:var(--dim);letter-spacing:.1em}
.subj-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.subj-card{
  background:var(--s1);border:1px solid var(--b1);border-radius:12px;
  padding:20px 16px;cursor:pointer;transition:all .2s;
  display:flex;flex-direction:column;gap:10px;opacity:0;
  position:relative;overflow:hidden;
}
.subj-card::after{
  content:'';position:absolute;bottom:0;left:0;right:0;height:2px;
  background:var(--sc,var(--g));transform:scaleX(0);transition:transform .25s;
  transform-origin:left;
}
.subj-card:hover::after,.subj-card.sel::after{transform:scaleX(1)}
.subj-card:hover,.subj-card.sel{
  border-color:var(--sc,var(--g));
  background:linear-gradient(135deg,var(--s2) 0%,var(--s1) 100%);
  transform:translateY(-3px);
}
.subj-icon-wrap{
  width:36px;height:36px;border-radius:8px;border:1px solid var(--b2);
  display:flex;align-items:center;justify-content:center;
}
.subj-icon-wrap svg{width:18px;height:18px}
.subj-name{font-size:.85rem;font-weight:700;color:var(--head);letter-spacing:.04em}
.subj-hint{font-size:.6rem;color:var(--dim);letter-spacing:.08em}

/* ─── QB BROWSER ─────────────────────────────────────────────────────────── */
.qb-layout{display:grid;grid-template-columns:260px 1fr;gap:20px;margin-top:8px}
.qb-sidebar{
  background:var(--s1);border:1px solid var(--b1);border-radius:12px;
  padding:16px;height:fit-content;position:sticky;top:74px;
}
.sidebar-title{font-size:.65rem;font-weight:700;letter-spacing:.15em;text-transform:uppercase;color:var(--dim);margin-bottom:12px}
.qb-subject-list{display:flex;flex-direction:column;gap:4px}
.qb-subj-btn{
  background:transparent;border:1px solid transparent;border-radius:6px;
  padding:8px 12px;text-align:left;cursor:pointer;width:100%;
  font-family:'Quantico',sans-serif;font-size:.78rem;color:var(--dim);
  transition:all .18s;display:flex;align-items:center;gap:8px;
}
.qb-subj-btn:hover{color:var(--text);background:var(--s2)}
.qb-subj-btn.active{color:var(--g);background:var(--g2);border-color:rgba(200,255,0,.2)}
.qb-unit-list{margin-top:8px;padding-top:8px;border-top:1px solid var(--b1)}
.qb-unit-btn{
  background:transparent;border:1px solid transparent;border-radius:6px;
  padding:6px 12px 6px 28px;text-align:left;cursor:pointer;width:100%;
  font-family:'Quantico',sans-serif;font-size:.72rem;color:var(--dim);
  transition:all .18s;
}
.qb-unit-btn:hover{color:var(--text)}
.qb-unit-btn.active{color:var(--g)}
.qb-main{min-width:0}
.qb-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px}
.qb-title{font-size:1.1rem;font-weight:700;color:var(--head)}
.qb-filters{display:flex;gap:8px;flex-wrap:wrap}
.chip{
  background:var(--s2);border:1px solid var(--b1);color:var(--dim);
  padding:5px 13px;border-radius:99px;font-family:'Quantico',sans-serif;
  font-size:.65rem;font-weight:700;letter-spacing:.08em;cursor:pointer;transition:all .18s;
}
.chip:hover{border-color:var(--b3);color:var(--text)}
.chip.active{border-color:var(--g);color:var(--g);background:var(--g2)}

/* ─── QUESTION CARD ──────────────────────────────────────────────────────── */
.q-card{
  background:var(--s1);border:1px solid var(--b1);border-radius:12px;
  overflow:hidden;margin-bottom:12px;opacity:0;
  transition:border-color .2s;
}
.q-hdr{
  display:flex;align-items:center;gap:8px;flex-wrap:wrap;
  padding:11px 18px;background:var(--s2);border-bottom:1px solid var(--b1);
}
.qbadge{
  font-size:.58rem;font-weight:700;letter-spacing:.08em;text-transform:uppercase;
  padding:3px 9px;border-radius:4px;border:1px solid;
}
.bm {color:var(--blue);  border-color:var(--blue);  background:rgba(79,195,247,.07)}
.bt {color:var(--amber); border-color:var(--amber); background:rgba(255,179,0,.07)}
.bf {color:var(--purple);border-color:var(--purple);background:rgba(179,157,219,.07)}
.bc {color:var(--g);     border-color:var(--g);     background:var(--g2)}
.q-topic{font-size:.62rem;color:var(--dim);margin-left:auto}
.q-subj{font-size:.62rem;color:var(--dim)}
.q-diff{font-size:.6rem;font-weight:700;letter-spacing:.08em;padding:2px 8px;border-radius:4px;border:1px solid}
.de{color:var(--g);    border-color:rgba(200,255,0,.3)}
.dm{color:var(--amber);border-color:rgba(255,179,0,.3)}
.dh{color:var(--red);  border-color:rgba(255,71,87,.3)}
.q-body{padding:20px 20px 0}
.q-text{font-size:.9rem;line-height:1.75;color:var(--text);white-space:pre-wrap}
.q-text pre{
  background:#05060a;border:1px solid var(--b1);border-radius:6px;
  padding:12px 16px;margin:12px 0;font-family:'Quantico',monospace;
  font-size:.78rem;color:var(--g);line-height:1.6;overflow-x:auto;
}
.q-text code{
  font-family:'Quantico',monospace;font-size:.82rem;
  background:var(--s2);border:1px solid var(--b1);border-radius:3px;
  padding:1px 5px;color:var(--g);
}
.opts{display:flex;flex-direction:column;gap:7px;margin-top:16px}
.opt{
  background:var(--s2);border:1px solid var(--b1);border-radius:8px;
  padding:11px 15px;cursor:pointer;font-size:.85rem;
  transition:border-color .15s,background .15s;
  display:flex;align-items:flex-start;gap:10px;
}
.opt:hover{border-color:var(--blue);background:rgba(79,195,247,.03)}
.opt.sel  {border-color:var(--g);   background:var(--g2);    color:var(--g)}
.opt.ok   {border-color:var(--g);   background:rgba(200,255,0,.09);color:var(--g);cursor:default}
.opt.bad  {border-color:var(--red); background:rgba(255,71,87,.07);color:var(--red);cursor:default}
.opt-lbl{
  min-width:22px;height:22px;border-radius:4px;background:var(--b1);
  font-size:.62rem;font-weight:700;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;color:var(--dim);
}
.q-foot{padding:14px 20px 20px}
.btn-sub{
  background:transparent;border:1px solid var(--b2);color:var(--dim);
  padding:8px 20px;border-radius:99px;font-family:'Quantico',sans-serif;
  font-size:.7rem;font-weight:700;letter-spacing:.08em;cursor:pointer;
  transition:all .2s;text-transform:uppercase;
}
.btn-sub:hover{border-color:var(--g);color:var(--g);background:var(--g2)}
.btn-sub:disabled{opacity:.3;cursor:default}
.feedback{
  margin-top:10px;padding:11px 14px;border-radius:8px;
  font-size:.8rem;display:none;line-height:1.65;
}
.feedback.ok {background:rgba(200,255,0,.06);border:1px solid rgba(200,255,0,.2);color:var(--g)}
.feedback.bad{background:rgba(255,71,87,.06); border:1px solid rgba(255,71,87,.2); color:var(--red)}
.feedback.show{display:block}

/* ─── PRACTICE MODE ──────────────────────────────────────────────────────── */
.practice-setup{
  max-width:600px;margin:0 auto;padding-top:20px;
}
.ps-card{
  background:var(--s1);border:1px solid var(--b1);border-radius:16px;
  padding:32px;margin-bottom:16px;
}
.ps-title{font-size:1.1rem;font-weight:700;color:var(--head);margin-bottom:20px;
  letter-spacing:.04em;display:flex;align-items:center;gap:10px}
.ps-title .num{
  width:28px;height:28px;background:var(--g);border-radius:6px;
  font-size:.75rem;font-weight:700;color:var(--bg);
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
}
.subject-selector{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:8px}
.ss-btn{
  background:var(--s2);border:1px solid var(--b1);border-radius:8px;
  padding:10px 8px;text-align:center;cursor:pointer;
  font-family:'Quantico',sans-serif;font-size:.7rem;font-weight:700;
  color:var(--dim);transition:all .18s;
}
.ss-btn:hover{border-color:var(--b3);color:var(--text)}
.ss-btn.sel{border-color:var(--g);color:var(--g);background:var(--g2)}
.diff-row{display:flex;gap:8px}
.diff-btn{
  flex:1;background:var(--s2);border:1px solid var(--b1);border-radius:8px;
  padding:10px;text-align:center;cursor:pointer;
  font-family:'Quantico',sans-serif;font-size:.7rem;font-weight:700;
  color:var(--dim);transition:all .18s;text-transform:uppercase;letter-spacing:.08em;
}
.diff-btn.sel.easy  {border-color:var(--g);   color:var(--g);   background:var(--g2)}
.diff-btn.sel.medium{border-color:var(--amber);color:var(--amber);background:rgba(255,179,0,.07)}
.diff-btn.sel.hard  {border-color:var(--red);  color:var(--red);  background:rgba(255,71,87,.07)}
.qty-row{display:flex;gap:8px}
.qty-btn{
  flex:1;background:var(--s2);border:1px solid var(--b1);border-radius:8px;
  padding:10px;text-align:center;cursor:pointer;
  font-family:'Quantico',sans-serif;font-size:.82rem;font-weight:700;
  color:var(--dim);transition:all .18s;
}
.qty-btn.sel{border-color:var(--g);color:var(--g);background:var(--g2)}
.start-btn{
  width:100%;padding:14px;border-radius:10px;
  background:var(--g);border:none;color:var(--bg);
  font-family:'Quantico',sans-serif;font-size:.85rem;font-weight:700;
  letter-spacing:.12em;text-transform:uppercase;cursor:pointer;
  transition:all .2s;margin-top:4px;
}
.start-btn:hover{background:transparent;color:var(--g);border:1px solid var(--g)}
.start-btn:disabled{opacity:.4;cursor:default;background:var(--b2);color:var(--dim);border:none}

/* Practice session */
.practice-session{display:none}
.ps-progress{
  display:flex;align-items:center;gap:16px;
  background:var(--s1);border:1px solid var(--b1);border-radius:10px;
  padding:14px 20px;margin-bottom:20px;
}
.ps-prog-bar{flex:1;height:4px;background:var(--b1);border-radius:2px;overflow:hidden}
.ps-prog-fill{height:100%;background:var(--g);border-radius:2px;transition:width .4s ease}
.ps-prog-txt{font-size:.65rem;font-weight:700;letter-spacing:.1em;color:var(--dim);white-space:nowrap}
.ps-score{font-size:.65rem;font-weight:700;letter-spacing:.1em;color:var(--g);white-space:nowrap}
.ps-nav{display:flex;gap:10px;margin-top:16px;justify-content:flex-end}

/* Practice results */
.practice-results{
  max-width:600px;margin:0 auto;text-align:center;
  display:none;
}
.result-score{
  font-size:5rem;font-weight:700;color:var(--g);line-height:1;margin-bottom:8px;
}
.result-label{font-size:.75rem;letter-spacing:.2em;text-transform:uppercase;color:var(--dim);margin-bottom:32px}
.result-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:32px}
.rg-item{
  background:var(--s1);border:1px solid var(--b1);border-radius:10px;
  padding:18px;
}
.rg-n{font-size:1.8rem;font-weight:700;color:var(--head);line-height:1;margin-bottom:4px}
.rg-l{font-size:.6rem;letter-spacing:.12em;text-transform:uppercase;color:var(--dim)}

/* ─── STATS ──────────────────────────────────────────────────────────────── */
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:28px}
.stat-tile{
  background:var(--s1);border:1px solid var(--b1);border-radius:12px;
  padding:22px;position:relative;overflow:hidden;
}
.stat-tile::after{
  content:'';position:absolute;top:-20px;right:-20px;
  width:80px;height:80px;border-radius:50%;
  background:radial-gradient(circle,var(--gw) 0%,transparent 70%);
  opacity:.5;pointer-events:none;
}
.tg{--gw:rgba(200,255,0,.5)}.ta{--gw:rgba(255,179,0,.5)}.tb{--gw:rgba(79,195,247,.5)}
.st-n{font-size:2.8rem;font-weight:700;color:var(--head);line-height:1;margin-bottom:5px;letter-spacing:-.02em}
.st-l{font-size:.6rem;letter-spacing:.15em;text-transform:uppercase;color:var(--dim)}
.sp-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:24px}
.sp-card{background:var(--s1);border:1px solid var(--b1);border-radius:12px;padding:18px;opacity:0}
.sp-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.sp-name{font-size:.85rem;font-weight:700;color:var(--head);display:flex;align-items:center;gap:8px}
.sp-acc{font-size:.68rem;font-weight:700;padding:3px 9px;border-radius:4px;border:1px solid}
.ring{position:relative;width:52px;height:52px;flex-shrink:0}
.ring svg{width:52px;height:52px;transform:rotate(-90deg)}
.ring-bg{fill:none;stroke:var(--b1);stroke-width:4}
.ring-fill{fill:none;stroke-width:4;stroke-linecap:round}
.ring-val{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:.58rem;font-weight:700;color:var(--head)}
.ring-wrap{display:flex;align-items:center;gap:12px}
.ri-n{font-size:.82rem;color:var(--text);margin-bottom:2px}
.ri-m{font-size:.6rem;color:var(--dim);letter-spacing:.06em}
.topic-card{background:var(--s1);border:1px solid var(--b1);border-radius:12px;padding:22px}
.ttable{width:100%;border-collapse:collapse}
.ttable th{font-size:.58rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:var(--dim);padding:8px 12px;border-bottom:1px solid var(--b1);text-align:left}
.ttable td{padding:9px 12px;border-bottom:1px solid var(--b1);font-size:.82rem;vertical-align:middle}
.ttable tr:last-child td{border-bottom:none}
.ttable tr:hover td{background:rgba(255,255,255,.012)}
.pbar{background:var(--b1);border-radius:2px;height:3px;overflow:hidden;width:80px}
.pbar-f{height:100%;border-radius:2px}

/* ─── MISC UI ────────────────────────────────────────────────────────────── */
#toast{
  position:fixed;bottom:24px;right:24px;
  background:var(--s2);border:1px solid var(--b2);color:var(--text);
  padding:11px 18px;border-radius:8px;font-size:.7rem;font-weight:700;
  letter-spacing:.04em;z-index:999;pointer-events:none;
  opacity:0;transform:translateY(12px);transition:opacity .2s,transform .2s;max-width:280px;
}
#toast.show{opacity:1;transform:translateY(0)}
#toast.ok {border-color:rgba(200,255,0,.4);color:var(--g)}
#toast.err{border-color:rgba(255,71,87,.4); color:var(--red)}
.spin{display:inline-block;width:13px;height:13px;border:2px solid var(--b2);border-top-color:var(--g);border-radius:50%;animation:sp .6s linear infinite;vertical-align:middle}
@keyframes sp{to{transform:rotate(360deg)}}
.empty{text-align:center;padding:60px 20px;color:var(--dim);font-size:.85rem}
.empty h3{font-size:1.2rem;font-weight:700;color:var(--text);margin-bottom:8px;letter-spacing:.04em}
.empty code{color:var(--g);font-family:'Quantico',monospace}

@media(max-width:720px){
  .hero{grid-template-columns:1fr;padding:48px 0 36px}
  .hero-right{display:none}
  .subj-grid{grid-template-columns:repeat(2,1fr)}
  .qb-layout{grid-template-columns:1fr}
  .qb-sidebar{position:static}
  .stats-grid,.sp-grid{grid-template-columns:1fr}
  .subject-selector{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>

<!-- SVG icons -->
<svg style="display:none" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <symbol id="ico-chem" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"><path d="M9 3h6M9 3v6l-5 9a2 2 0 001.7 3h12.6A2 2 0 0020 18l-5-9V3"/></symbol>
    <symbol id="ico-eee"  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></symbol>
    <symbol id="ico-epd"  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></symbol>
    <symbol id="ico-evs"  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"><path d="M12 22V12M12 12C12 7 7 3 3 3c0 4 3 8 9 9M12 12c0-5 5-9 9-9-1 5-5 8-9 9"/></symbol>
    <symbol id="ico-mes"  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"><circle cx="12" cy="12" r="3"/><path d="M12 2v3M12 19v3M4.2 4.2l2.1 2.1M17.7 17.7l2.1 2.1M2 12h3M19 12h3M4.2 19.8l2.1-2.1M17.7 6.3l2.1-2.1"/></symbol>
    <symbol id="ico-stat" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"><path d="M3 21h18M12 3L3 21h18L12 3z"/><path d="M12 10v5"/></symbol>
    <symbol id="ico-logo" viewBox="0 0 24 24"><polygon points="12,2 22,20 2,20" fill="currentColor"/></symbol>
  </defs>
</svg>

<header>
  <div class="hdr">
    <div class="logo">
      <div class="logo-mark"><svg><use href="#ico-logo"/></svg></div>
      Examino
      <span class="logo-sub">PESU · SEM 1</span>
    </div>
    <nav>
      <button class="nb active" onclick="showPage('home')">Home</button>
      <button class="nb" onclick="showPage('qb')">Question Bank</button>
      <button class="nb" onclick="showPage('practice')">Practice</button>
      <button class="nb" onclick="showPage('stats')">Stats</button>
    </nav>
  </div>
</header>

<div id="toast"></div>

<!-- ═════════════ HOME ═════════════ -->
<div id="page-home" class="page visible">
<div class="wrap">
  <div class="hero">
    <div class="hero-left">
      <div class="hero-tag"><span class="hero-tag-dot"></span>Adaptive · PESU Official QB</div>
      <h1 class="hero-h1">Ace your<br><span class="accent">sem exams.</span></h1>
      <p class="hero-p">Questions sourced directly from official PESU Question Banks and Q&A files. Organised by Subject → Unit → Topic. Adaptive difficulty.</p>
      <div class="hero-cta">
        <button class="btn btn-primary" onclick="showPage('practice')">Start Practice</button>
        <button class="btn btn-ghost" onclick="showPage('qb')">Browse QB</button>
      </div>
    </div>
    <div class="hero-right">
      <div class="h-stat hsg"><div class="h-stat-n" id="h-qs">—</div><div class="h-stat-l">Questions</div></div>
      <div class="h-stat hsa"><div class="h-stat-n" id="h-att">—</div><div class="h-stat-l">Attempts</div></div>
      <div class="h-stat hsb"><div class="h-stat-n" id="h-acc">—</div><div class="h-stat-l">Accuracy</div></div>
      <div class="h-stat hsp"><div class="h-stat-n" id="h-sub">6</div><div class="h-stat-l">Subjects</div></div>
    </div>
  </div>

  <div class="subj-section">
    <div class="sec-hdr">
      <span class="sec-title">Subjects</span>
      <span class="sec-meta" id="home-sub-meta"></span>
    </div>
    <div class="subj-grid" id="home-subj-grid"></div>
  </div>
</div>
</div>

<!-- ═════════════ QB BROWSER ═════════════ -->
<div id="page-qb" class="page">
<div class="wrap">
  <div class="sec-hdr" style="margin-top:4px;margin-bottom:20px">
    <span class="sec-title">Question Bank</span>
    <div class="qb-filters" id="qb-diff-chips">
      <span class="chip active" onclick="setQBDiff(this,'all')">All</span>
      <span class="chip" onclick="setQBDiff(this,'easy')">Easy</span>
      <span class="chip" onclick="setQBDiff(this,'medium')">Medium</span>
      <span class="chip" onclick="setQBDiff(this,'hard')">Hard</span>
    </div>
  </div>
  <div class="qb-layout">
    <div class="qb-sidebar">
      <div class="sidebar-title">Subjects & Units</div>
      <div class="qb-subject-list" id="qb-subj-list"></div>
    </div>
    <div class="qb-main">
      <div class="qb-header">
        <span class="qb-title" id="qb-main-title">Select a subject</span>
        <span class="sec-meta" id="qb-count"></span>
      </div>
      <div id="qb-q-list">
        <div class="empty"><h3>Select a subject</h3><p>Use the sidebar to browse by subject and unit.</p></div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- ═════════════ PRACTICE ═════════════ -->
<div id="page-practice" class="page">
<div class="wrap">

  <!-- Setup -->
  <div id="practice-setup" class="practice-setup">
    <div class="ps-card">
      <div class="ps-title"><span class="num">1</span>Choose Subject</div>
      <div class="subject-selector" id="prac-subj-sel"></div>
    </div>
    <div class="ps-card">
      <div class="ps-title"><span class="num">2</span>Difficulty</div>
      <div class="diff-row">
        <div class="diff-btn easy sel" onclick="setPDiff(this,'easy')">Easy</div>
        <div class="diff-btn medium" onclick="setPDiff(this,'medium')">Medium</div>
        <div class="diff-btn hard" onclick="setPDiff(this,'hard')">Hard</div>
        <div class="diff-btn" onclick="setPDiff(this,'all')" style="flex:1.5">All</div>
      </div>
    </div>
    <div class="ps-card">
      <div class="ps-title"><span class="num">3</span>Number of Questions</div>
      <div class="qty-row">
        <div class="qty-btn sel" onclick="setPQty(this,5)">5</div>
        <div class="qty-btn" onclick="setPQty(this,10)">10</div>
        <div class="qty-btn" onclick="setPQty(this,15)">15</div>
        <div class="qty-btn" onclick="setPQty(this,20)">20</div>
      </div>
    </div>
    <button class="start-btn" id="start-btn" onclick="startPractice()">Start Session →</button>
  </div>

  <!-- Active session -->
  <div id="practice-session" class="practice-session">
    <div class="ps-progress">
      <div class="ps-prog-bar"><div class="ps-prog-fill" id="ps-prog" style="width:0%"></div></div>
      <span class="ps-prog-txt" id="ps-prog-txt">0 / 0</span>
      <span class="ps-score" id="ps-score-live">0 correct</span>
    </div>
    <div id="ps-q-wrap"></div>
    <div class="ps-nav">
      <button class="btn btn-ghost" id="ps-next-btn" onclick="psNext()" style="display:none">Next →</button>
      <button class="btn btn-ghost" onclick="endPractice()">End Session</button>
    </div>
  </div>

  <!-- Results -->
  <div id="practice-results" class="practice-results">
    <div class="result-score" id="res-pct">0%</div>
    <div class="result-label">Session Complete</div>
    <div class="result-grid">
      <div class="rg-item"><div class="rg-n" id="res-correct">0</div><div class="rg-l">Correct</div></div>
      <div class="rg-item"><div class="rg-n" id="res-wrong">0</div><div class="rg-l">Wrong</div></div>
      <div class="rg-item"><div class="rg-n" id="res-total">0</div><div class="rg-l">Total</div></div>
    </div>
    <div style="display:flex;gap:12px;justify-content:center">
      <button class="btn btn-primary" onclick="resetPractice()">Try Again</button>
      <button class="btn btn-ghost" onclick="showPage('stats')">View Stats</button>
    </div>
  </div>

</div>
</div>

<!-- ═════════════ STATS ═════════════ -->
<div id="page-stats" class="page">
<div class="wrap">
  <div class="sec-hdr" style="margin-top:4px;margin-bottom:20px">
    <span class="sec-title">Performance Board</span>
    <button class="btn btn-ghost" onclick="loadStats()" style="padding:7px 16px;font-size:.65rem">↻ Refresh</button>
  </div>
  <div class="stats-grid">
    <div class="stat-tile tg"><div class="st-n" id="s-att">—</div><div class="st-l">Total Attempts</div></div>
    <div class="stat-tile ta"><div class="st-n" id="s-acc">—</div><div class="st-l">Overall Accuracy</div></div>
    <div class="stat-tile tb"><div class="st-n" id="s-top">—</div><div class="st-l">Topics Tracked</div></div>
  </div>
  <div class="sec-hdr"><span class="sec-title">By Subject</span></div>
  <div class="sp-grid" id="sp-grid"></div>
  <div class="topic-card">
    <div class="sec-hdr" style="margin-bottom:16px"><span class="sec-title" style="font-size:.85rem">Topic Breakdown</span></div>
    <div id="t-table-wrap">
      <div class="empty" style="padding:20px 0"><h3>No data yet</h3><p>Answer questions to see stats.</p></div>
    </div>
  </div>
</div>
</div>

<script>
// ═════════════════════════════════════════════════════════════════════════════
//  CONFIG
// ═════════════════════════════════════════════════════════════════════════════
const API = window.location.protocol === 'file:'
  ? 'http://localhost:8000'
  : window.location.origin;

const SUBJ_META = {
  Chemistry:{ ico:'ico-chem', col:'#4fc3f7' },
  EEE:      { ico:'ico-eee',  col:'#ffb300' },
  EPD:      { ico:'ico-epd',  col:'#c8ff00' },
  EVS:      { ico:'ico-evs',  col:'#69f0ae' },
  MES:      { ico:'ico-mes',  col:'#ff8a65' },
  Statics:  { ico:'ico-stat', col:'#ce93d8' },
};

let answered={}, selected={};

// QB state
let qbSubject='', qbUnit='', qbDiff='all', qbAllSubjects=[];

// Practice state
let pSubject='all', pDiff='easy', pQty=5;
let psQuestions=[], psCurrent=0, psCorrect=0, psAnswered={};

// ═════════════════════════════════════════════════════════════════════════════
//  UTILS
// ═════════════════════════════════════════════════════════════════════════════
function toast(msg,type='ok'){
  const t=document.getElementById('toast');
  t.textContent=msg;t.className=`show ${type}`;
  clearTimeout(t._t);t._t=setTimeout(()=>t.className='',3000);
}
function escH(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
function esc(s){return String(s).replace(/'/g,"\\'")}
function countUp(id,target){
  const el=document.getElementById(id);if(!el||!target)return;
  anime({targets:{v:0},v:target,duration:900,easing:'easeOutExpo',
    update(a){el.textContent=Math.round(a.animations[0].currentValue);}});
}

// ═════════════════════════════════════════════════════════════════════════════
//  NAVIGATION
// ═════════════════════════════════════════════════════════════════════════════
function showPage(name){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('visible'));
  document.querySelectorAll('.nb').forEach(b=>b.classList.remove('active'));
  const page=document.getElementById(`page-${name}`);
  page.classList.add('visible');
  const idx={home:0,qb:1,practice:2,stats:3}[name]??0;
  document.querySelectorAll('.nb')[idx]?.classList.add('active');
  anime({targets:page,opacity:[0,1],translateY:[12,0],duration:340,easing:'easeOutCubic'});
  if(name==='home')     initHome();
  if(name==='qb')       initQB();
  if(name==='practice') initPractice();
  if(name==='stats')    loadStats();
}

// ═════════════════════════════════════════════════════════════════════════════
//  HOME
// ═════════════════════════════════════════════════════════════════════════════
async function initHome(){
  anime({targets:'.hero-left',opacity:[0,1],translateY:[20,0],duration:600,easing:'easeOutExpo',delay:60});
  try{
    const [sRes,stRes]=await Promise.all([fetch(`${API}/subjects`),fetch(`${API}/stats`)]);
    const subjects=await sRes.json();
    const stats=await stRes.json();
    countUp('h-qs', stats.total_questions??0);
    countUp('h-att',stats.total_attempts??0);
    document.getElementById('h-acc').textContent=stats.total_attempts>0?`${stats.overall_accuracy}%`:'—';
    document.getElementById('h-sub').textContent=subjects.length;
    document.getElementById('home-sub-meta').textContent=`${stats.total_questions} total questions`;

    const grid=document.getElementById('home-subj-grid');
    grid.innerHTML=subjects.map(s=>{
      const m=SUBJ_META[s]||{ico:'ico-stat',col:'#c8ff00'};
      const bys=stats.by_subject?.[s];
      const hint=bys?`${bys.attempts} attempts · ${bys.accuracy}%`:'tap to practice';
      return `<div class="subj-card" style="--sc:${m.col}" onclick="goPractice('${s}')">
        <div class="subj-icon-wrap" style="color:${m.col}">
          <svg><use href="#${m.ico}"/></svg>
        </div>
        <div class="subj-name">${s}</div>
        <div class="subj-hint">${hint}</div>
      </div>`;
    }).join('');

    anime({targets:'.subj-card',opacity:[0,1],translateY:[16,0],
      delay:anime.stagger(55,{start:150}),duration:380,easing:'easeOutCubic'});
  }catch(e){
    document.getElementById('home-subj-grid').innerHTML=
      `<div class="empty" style="grid-column:1/-1"><h3>API Offline</h3>
       <p>Run <code>uvicorn main:app --reload</code> in the backend/ folder.</p></div>`;
  }
}
function goPractice(s){pSubject=s;showPage('practice');}

// ═════════════════════════════════════════════════════════════════════════════
//  QB BROWSER
// ═════════════════════════════════════════════════════════════════════════════
async function initQB(){
  if(qbAllSubjects.length) return;
  try{
    qbAllSubjects=await (await fetch(`${API}/subjects`)).json();
    buildQBSidebar();
  }catch(e){}
}

function buildQBSidebar(){
  const list=document.getElementById('qb-subj-list');
  list.innerHTML=qbAllSubjects.map(s=>{
    const m=SUBJ_META[s]||{ico:'ico-stat',col:'#c8ff00'};
    return `<button class="qb-subj-btn" onclick="selectQBSubject('${s}',this)" style="--c:${m.col}">
      <svg width="14" height="14" style="color:${m.col};flex-shrink:0"><use href="#${m.ico}"/></svg>${s}
    </button>`;
  }).join('');
}

async function selectQBSubject(subj,el){
  qbSubject=subj; qbUnit='';
  document.querySelectorAll('.qb-subj-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('qb-main-title').textContent=subj;

  // Load units
  try{
    const units=await (await fetch(`${API}/units?subject=${encodeURIComponent(subj)}`)).json();
    let unitHTML='';
    if(units.length){
      unitHTML=`<div class="qb-unit-list">
        <button class="qb-unit-btn active" onclick="selectQBUnit('',this)">All Units</button>
        ${units.map(u=>`<button class="qb-unit-btn" onclick="selectQBUnit('${u}',this)">${u}</button>`).join('')}
      </div>`;
    }
    // Append after subject buttons
    const existing=document.querySelector('.qb-unit-list');
    if(existing) existing.remove();
    el.insertAdjacentHTML('afterend',unitHTML);
  }catch(e){}
  loadQBQuestions();
}

function selectQBUnit(unit,el){
  qbUnit=unit;
  document.querySelectorAll('.qb-unit-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  loadQBQuestions();
}

function setQBDiff(el,diff){
  qbDiff=diff;
  document.querySelectorAll('#qb-diff-chips .chip').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  if(qbSubject) loadQBQuestions();
}

async function loadQBQuestions(){
  if(!qbSubject) return;
  const list=document.getElementById('qb-q-list');
  list.innerHTML=`<div style="text-align:center;padding:40px"><span class="spin"></span></div>`;

  let url=`${API}/questions?subject=${encodeURIComponent(qbSubject)}&limit=60`;
  if(qbUnit) url+=`&unit=${encodeURIComponent(qbUnit)}`;
  if(qbDiff!=='all') url+=`&difficulty=${qbDiff}`;

  try{
    const qs=await (await fetch(url)).json();
    document.getElementById('qb-count').textContent=`${qs.length} questions`;
    if(!qs.length){
      list.innerHTML=`<div class="empty"><h3>No questions</h3><p>Try different filters.</p></div>`;return;
    }
    answered={}; selected={};
    list.innerHTML=qs.map(q=>buildQCard(q)).join('');
    anime({targets:'#qb-q-list .q-card',opacity:[0,1],translateY:[12,0],
      delay:anime.stagger(30),duration:320,easing:'easeOutCubic'});
  }catch(e){
    list.innerHTML=`<div class="empty"><h3>Error</h3><p>${e.message}</p></div>`;
  }
}

// ═════════════════════════════════════════════════════════════════════════════
//  QUESTION CARD BUILDER (shared by QB + practice)
// ═════════════════════════════════════════════════════════════════════════════
const TL={mcq:'MCQ',true_false:'T/F',fill_blank:'Fill',code:'Code',complexity:'Big-O'};
const KS=['A','B','C','D','E'];

function buildQCard(q, practiceMode=false){
  const txt=q.question_text
    .replace(/```([\s\S]*?)```/g,'<pre>$1</pre>')
    .replace(/`([^`]+)`/g,'<code>$1</code>');

  let inp='';
  if(q.options?.length){
    inp=`<div class="opts">${q.options.map((o,i)=>`
      <div class="opt" id="op-${q.question_id}-${i}"
           onclick="selOpt('${q.question_id}',${i},'${esc(o)}',${practiceMode})">
        <span class="opt-lbl">${KS[i]}</span>${escH(o)}
      </div>`).join('')}</div>`;
  }

  const bclass={mcq:'bm',true_false:'bt',fill_blank:'bf',code:'bc',complexity:'bc'}[q.question_type]||'bm';
  const dclass={easy:'de',medium:'dm',hard:'dh'}[q.difficulty_level]||'dm';

  return `<div class="q-card" id="qc-${q.question_id}">
    <div class="q-hdr">
      <span class="qbadge ${bclass}">${TL[q.question_type]||q.question_type}</span>
      <span class="q-topic">${q.topic}</span>
      <span class="q-subj">${q.unit}</span>
      <span class="q-diff ${dclass}">${q.difficulty_level}</span>
    </div>
    <div class="q-body"><div class="q-text">${txt}</div>${inp}</div>
    <div class="q-foot">
      <button class="btn-sub" id="btn-${q.question_id}"
              onclick="submitA('${q.question_id}','${q.question_type}',${practiceMode})">Submit</button>
      <div class="feedback" id="fb-${q.question_id}"></div>
    </div>
  </div>`;
}

function selOpt(qid,idx,val,practiceMode=false){
  if(answered[qid]) return;
  document.querySelectorAll(`[id^="op-${qid}-"]`).forEach(e=>e.classList.remove('sel'));
  const el=document.getElementById(`op-${qid}-${idx}`);
  el?.classList.add('sel'); selected[qid]=val;
  anime({targets:el,scale:[.97,1],duration:160,easing:'easeOutBack'});
}

async function submitA(qid,qtype,practiceMode=false){
  if(answered[qid]) return;
  const ans=selected[qid]||'';
  if(!ans){toast('Select an answer first','err');return;}

  const btn=document.getElementById(`btn-${qid}`);
  btn.disabled=true; btn.innerHTML='<span class="spin"></span>';

  try{
    const res=await fetch(`${API}/attempt`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({question_id:qid,user_answer:ans}),
    });
    if(!res.ok){
      const err=await res.json().catch(()=>({}));
      throw new Error(err.detail||`HTTP ${res.status}`);
    }
    const d=await res.json();
    answered[qid]=true; btn.style.display='none';

    document.querySelectorAll(`[id^="op-${qid}-"]`).forEach(el=>{
      const t=el.textContent.trim().replace(/^[A-E]\s*/,'');
      if(t===d.correct_answer.trim()||el.textContent.includes(d.correct_answer.trim()))
        el.classList.add('ok');
      else if(el.classList.contains('sel'))
        el.classList.add('bad');
      el.style.cursor='default';
    });

    const fb=document.getElementById(`fb-${qid}`);
    fb.className=`feedback show ${d.correct?'ok':'bad'}`;
    fb.innerHTML=`${d.correct?'✓ Correct':'✗ Wrong'} — ${escH(d.explanation)}
      <span style="font-size:.6rem;display:block;margin-top:3px;opacity:.6">difficulty → ${d.new_difficulty}</span>`;
    anime({targets:fb,opacity:[0,1],translateY:[6,0],duration:260,easing:'easeOutCubic'});

    if(!d.correct){
      anime({targets:`#qc-${qid}`,translateX:[0,-7,7,-5,5,0],duration:380,easing:'easeInOutSine'});
      toast(`Answer: ${d.correct_answer}`,'err');
    } else {
      anime({targets:`#qc-${qid}`,borderColor:['#1e2330','#c8ff00','#1e2330'],duration:600,easing:'easeInOutQuad'});
      toast('Correct!');
    }

    // Practice mode: track score + reveal next button
    if(practiceMode){
      if(d.correct) psCorrect++;
      psAnswered[qid]=d.correct;
      document.getElementById('ps-score-live').textContent=`${psCorrect} correct`;
      document.getElementById('ps-next-btn').style.display='inline-flex';
    }

  }catch(e){
    btn.disabled=false;btn.textContent='Submit';
    toast(e.message||'Could not reach API','err');
  }
}

// ═════════════════════════════════════════════════════════════════════════════
//  PRACTICE MODE
// ═════════════════════════════════════════════════════════════════════════════
async function initPractice(){
  try{
    const subjects=await (await fetch(`${API}/subjects`)).json();
    const sel=document.getElementById('prac-subj-sel');
    sel.innerHTML=`<div class="ss-btn${pSubject==='all'?' sel':''}" onclick="setPSubj(this,'all')">All</div>`
      +subjects.map(s=>`<div class="ss-btn${pSubject===s?' sel':''}" onclick="setPSubj(this,'${s}')">${s}</div>`).join('');
  }catch(e){}
}

function setPSubj(el,s){
  pSubject=s;
  document.querySelectorAll('#prac-subj-sel .ss-btn').forEach(b=>b.classList.remove('sel'));
  el.classList.add('sel');
  anime({targets:el,scale:[.95,1],duration:180,easing:'easeOutBack'});
}
function setPDiff(el,d){
  pDiff=d;
  document.querySelectorAll('.diff-btn').forEach(b=>b.classList.remove('sel'));
  el.classList.add('sel');
}
function setPQty(el,n){
  pQty=n;
  document.querySelectorAll('.qty-btn').forEach(b=>b.classList.remove('sel'));
  el.classList.add('sel');
}

async function startPractice(){
  const btn=document.getElementById('start-btn');
  btn.disabled=true;btn.textContent='Loading…';

  let url=`${API}/questions?limit=${pQty}`;
  if(pSubject!=='all') url+=`&subject=${encodeURIComponent(pSubject)}`;
  if(pDiff!=='all') url+=`&difficulty=${pDiff}`;

  try{
    const qs=await (await fetch(url)).json();
    if(!qs.length){toast('No questions found for these filters','err');btn.disabled=false;btn.textContent='Start Session →';return;}

    // Shuffle
    psQuestions=qs.sort(()=>Math.random()-.5).slice(0,pQty);
    psCurrent=0; psCorrect=0; psAnswered={};
    answered={}; selected={};

    document.getElementById('practice-setup').style.display='none';
    document.getElementById('practice-results').style.display='none';
    const sess=document.getElementById('practice-session');
    sess.style.display='block';
    anime({targets:sess,opacity:[0,1],translateY:[14,0],duration:340,easing:'easeOutCubic'});

    renderPsQuestion();
  }catch(e){
    toast(e.message||'API error','err');
  }finally{
    btn.disabled=false;btn.textContent='Start Session →';
  }
}

function renderPsQuestion(){
  if(psCurrent>=psQuestions.length){endPractice();return;}
  const q=psQuestions[psCurrent];
  const wrap=document.getElementById('ps-q-wrap');
  wrap.innerHTML=buildQCard(q,true);
  anime({targets:'#ps-q-wrap .q-card',opacity:[0,1],translateY:[16,0],duration:320,easing:'easeOutCubic'});
  document.getElementById('ps-next-btn').style.display='none';

  // Progress
  const pct=Math.round((psCurrent/psQuestions.length)*100);
  document.getElementById('ps-prog').style.width=`${pct}%`;
  document.getElementById('ps-prog-txt').textContent=`${psCurrent+1} / ${psQuestions.length}`;
  document.getElementById('ps-score-live').textContent=`${psCorrect} correct`;

  // Reset answered state for new question only
  const qid=q.question_id;
  delete answered[qid]; delete selected[qid];
}

function psNext(){
  psCurrent++;
  renderPsQuestion();
}

function endPractice(){
  document.getElementById('practice-session').style.display='none';
  const res=document.getElementById('practice-results');
  const total=Object.keys(psAnswered).length||psCurrent;
  const wrong=total-psCorrect;
  const pct=total>0?Math.round((psCorrect/total)*100):0;

  document.getElementById('res-pct').textContent=`${pct}%`;
  document.getElementById('res-correct').textContent=psCorrect;
  document.getElementById('res-wrong').textContent=wrong;
  document.getElementById('res-total').textContent=total;
  res.style.display='block';
  anime({targets:res,opacity:[0,1],translateY:[20,0],duration:400,easing:'easeOutExpo'});
  anime({targets:'#res-pct',scale:[.8,1],duration:500,easing:'easeOutElastic(1,.6)'});
}

function resetPractice(){
  document.getElementById('practice-results').style.display='none';
  document.getElementById('practice-session').style.display='none';
  document.getElementById('practice-setup').style.display='block';
  psQuestions=[];psCurrent=0;psCorrect=0;psAnswered={};
  anime({targets:'#practice-setup',opacity:[0,1],translateY:[10,0],duration:300,easing:'easeOutCubic'});
}

// ═════════════════════════════════════════════════════════════════════════════
//  STATS
// ═════════════════════════════════════════════════════════════════════════════
async function loadStats(){
  try{
    const res=await fetch(`${API}/stats`);
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const data=await res.json();

    document.getElementById('s-att').textContent=data.total_attempts??0;
    document.getElementById('s-acc').textContent=data.total_attempts>0?`${data.overall_accuracy}%`:'—';
    document.getElementById('s-top').textContent=data.topics?.length??0;
    countUp('s-att',data.total_attempts??0);

    const grid=document.getElementById('sp-grid');
    const bySub=data.by_subject||{};
    const keys=Object.keys(bySub);

    if(!keys.length){
      grid.innerHTML=`<div class="empty" style="grid-column:1/-1"><h3>No data yet</h3><p>Answer questions to see subject performance.</p></div>`;
    } else {
      grid.innerHTML=keys.map(s=>{
        const d=bySub[s];
        const m=SUBJ_META[s]||{ico:'ico-stat',col:'#c8ff00'};
        const pct=d.accuracy;
        const col=pct>=70?'var(--g)':pct>=40?'var(--amber)':'var(--red)';
        const r=20,circ=2*Math.PI*r;
        return `<div class="sp-card">
          <div class="sp-hdr">
            <span class="sp-name">
              <svg width="14" height="14" style="color:${m.col}"><use href="#${m.ico}"/></svg>${s}
            </span>
            <span class="sp-acc" style="color:${col};border-color:${col}">${pct}%</span>
          </div>
          <div class="ring-wrap">
            <div class="ring">
              <svg viewBox="0 0 52 52">
                <circle class="ring-bg" cx="26" cy="26" r="${r}"/>
                <circle class="ring-fill" cx="26" cy="26" r="${r}"
                  stroke="${col}" stroke-dasharray="${circ}"
                  stroke-dashoffset="${circ}" data-target="${circ-(pct/100)*circ}"/>
              </svg>
              <div class="ring-val">${pct}%</div>
            </div>
            <div>
              <div class="ri-n">${d.attempts} attempts</div>
              <div class="ri-m">${d.correct} correct</div>
            </div>
          </div>
        </div>`;
      }).join('');

      anime({targets:'.sp-card',opacity:[0,1],translateY:[14,0],delay:anime.stagger(70),duration:380,easing:'easeOutCubic'});
      anime({
        targets:'.ring-fill',
        strokeDashoffset(el){return[parseFloat(el.getAttribute('stroke-dasharray')),parseFloat(el.getAttribute('data-target'))];},
        duration:900,delay:anime.stagger(80),easing:'easeOutCubic',
      });
    }

    const wrap=document.getElementById('t-table-wrap');
    if(!data.topics?.length){
      wrap.innerHTML=`<div class="empty" style="padding:20px 0"><h3>No topic data yet</h3></div>`;return;
    }
    wrap.innerHTML=`<table class="ttable">
      <thead><tr><th>Topic</th><th>Subject</th><th>Accuracy</th><th>Attempts</th><th>Difficulty</th></tr></thead>
      <tbody>${data.topics.map(t=>{
        const pct=t.accuracy;
        const fc=pct>=70?'var(--g)':pct>=40?'var(--amber)':'var(--red)';
        const dc={easy:'var(--g)',medium:'var(--amber)',hard:'var(--red)'}[t.difficulty]||'var(--dim)';
        return `<tr>
          <td>${escH(t.topic)}</td>
          <td style="font-size:.7rem;color:var(--dim)">${t.subject}</td>
          <td><div style="display:flex;align-items:center;gap:10px">
            <div class="pbar"><div class="pbar-f" style="width:${pct}%;background:${fc}"></div></div>
            <span style="font-size:.72rem">${pct}%</span>
          </div></td>
          <td style="font-size:.72rem">${t.attempts}</td>
          <td style="font-size:.68rem;color:${dc}">${t.difficulty}</td>
        </tr>`;
      }).join('')}</tbody>
    </table>`;
    anime({targets:'.ttable tbody tr',opacity:[0,1],translateX:[-8,0],delay:anime.stagger(25),duration:260,easing:'easeOutCubic'});
  }catch(e){
    document.getElementById('sp-grid').innerHTML=
      `<div class="empty" style="grid-column:1/-1;color:var(--red)">API not reachable — start uvicorn first.</div>`;
  }
}

// ═════════════════════════════════════════════════════════════════════════════
//  BOOT
// ═════════════════════════════════════════════════════════════════════════════
initHome();
</script>
</body>
</html>